"use strict";(self.webpackChunk_vestlang_docs=self.webpackChunk_vestlang_docs||[]).push([[799],{5971:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"ast","title":"Abstract Syntax Tree","description":"The DSL compiles into an abstract syntax tree describing the following:","source":"@site/docs/ast.md","sourceDirName":".","slug":"/ast","permalink":"/vestlang/ast","draft":false,"unlisted":false,"editUrl":"https://github.com/MattCantor/vestlang/docs/ast.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Abstract Syntax Tree","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"DSL Grammar","permalink":"/vestlang/dsl_grammar"},"next":{"title":"Evaluation","permalink":"/vestlang/evaluation"}}');var i=t(5270),a=t(6336);const r={title:"Abstract Syntax Tree",sidebar_position:2},o=void 0,l={},c=[{value:"Periodic Vesting Cadence",id:"periodic-vesting-cadence",level:3},{value:"Example: Periodic Vesting Cadence With Year -&gt; Month Conversion",id:"example-periodic-vesting-cadence-with-year---month-conversion",level:4},{value:"Example: Omitted OVER/EVERY",id:"example-omitted-overevery",level:4},{value:"Vesting start",id:"vesting-start",level:3},{value:"Example: Omitted Vesting Start",id:"example-omitted-vesting-start",level:4},{value:"Example: Vesting Start with Event",id:"example-vesting-start-with-event",level:4},{value:"Cliff accrual",id:"cliff-accrual",level:3},{value:"Example: Simple Cliff",id:"example-simple-cliff",level:4},{value:"Selectors",id:"selectors",level:3},{value:"Example: Vesting Start With Selector",id:"example-vesting-start-with-selector",level:4},{value:"Example: Cliff with Selector",id:"example-cliff-with-selector",level:4},{value:"Conditions",id:"conditions",level:3},{value:"Amounts",id:"amounts",level:3},{value:"Example: Omitted Amount",id:"example-omitted-amount",level:4},{value:"Example: Integer Amount",id:"example-integer-amount",level:4},{value:"Example: Decimal Amount",id:"example-decimal-amount",level:4},{value:"Example: Fraction Amount",id:"example-fraction-amount",level:4},{value:"Two-Tier Vesting Example",id:"two-tier-vesting-example",level:3}];function d(e){const n={admonition:"admonition",code:"code",em:"em",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"The DSL compiles into an abstract syntax tree describing the following:"}),"\n",(0,i.jsx)(n.h3,{id:"periodic-vesting-cadence",children:"Periodic Vesting Cadence"}),"\n",(0,i.jsxs)(n.p,{children:["The fundamental component of a vesting schedule is a periodic sequence of vesting installments. This periodic sequence one is described by a ",(0,i.jsx)(n.strong,{children:"number of installments"})," and the ",(0,i.jsx)(n.strong,{children:"duration of the step between each installment"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"duration of the step between each installment"})," is given by ",(0,i.jsx)(n.code,{children:"EVERY <duration>"})," in the grammar."]}),"\n",(0,i.jsxs)(n.p,{children:["In order to target natural language in the DSL, we derive the ",(0,i.jsx)(n.strong,{children:"number of installments"})," from the ",(0,i.jsx)(n.strong,{children:"overall length of the periodic sequence"}),", which is given by ",(0,i.jsx)(n.code,{children:"OVER <duration>"})," in the grammar."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsxs)(n.p,{children:["The grammar enforces that ",(0,i.jsx)(n.code,{children:"OVER"})," and ",(0,i.jsx)(n.code,{children:"EVERY"})," appear together. Neither can be provided without the other. If both are omitted, a duration of 0 days with 1 occurrence is injected, indicating automatic vesting on the resolved vesting start date."]}),(0,i.jsxs)(n.p,{children:["Years are converted to months and weeks are converted to days in the normalized AST. ",(0,i.jsx)(n.code,{children:"OVER"})," and ",(0,i.jsx)(n.code,{children:"EVERY"})," must have the same base unit (months or days)."]})]}),"\n",(0,i.jsx)(n.h4,{id:"example-periodic-vesting-cadence-with-year---month-conversion",children:"Example: Periodic Vesting Cadence With Year -> Month Conversion"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST OVER 4 years EVERY 1 month\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "periodicity": {\n      "type": "MONTHS",\n      "length": 1,\n      "occurrences": 48\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"example-omitted-overevery",children:"Example: Omitted OVER/EVERY"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "periodicity": {\n      "type": "DAYS",\n      "length": 0,\n      "occurrences": 1\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"vesting-start",children:"Vesting start"}),"\n",(0,i.jsx)(n.p,{children:"Each periodic sequence of vesting installments requires a vesting start date from which to calculate the series of installments."}),"\n",(0,i.jsxs)(n.p,{children:["The vesting-start is given by ",(0,i.jsx)(n.code,{children:"FROM <vesting-expr>"})," in the grammar. The vesting start may be omitted, in which case it is assumed to be the grant date of the security."]}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"EVENT vestingStart"})," is a system event that is derived during the normalization process. This is necessary so that the cliff can refer back to the resolved vesting start."]}),(0,i.jsxs)(n.p,{children:["However, this means that ",(0,i.jsx)(n.code,{children:"EVENT vestingStart"})," may not be used in the ",(0,i.jsx)(n.code,{children:"FROM <vesting-expr"}),", and doing so will throw an error."]})]}),"\n",(0,i.jsx)(n.h4,{id:"example-omitted-vesting-start",children:"Example: Omitted Vesting Start"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "SINGLETON",\n      "base": {\n        "type": "EVENT",\n        "value": "grantDate"\n      },\n      "offsets": []\n    },\n    "periodicity": {\n      "type": "DAYS",\n      "length": 0,\n      "occurrences": 1\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"example-vesting-start-with-event",children:"Example: Vesting Start with Event"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST FROM EVENT milestone\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "SINGLETON",\n      "base": {\n        "type": "EVENT",\n        "value": "milestone"\n      },\n      "offsets": []\n    },\n    "periodicity": {\n      "type": "DAYS",\n      "length": 0,\n      "occurrences": 1\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"cliff-accrual",children:"Cliff accrual"}),"\n",(0,i.jsx)(n.p,{children:'Another common feature of vesting schedules is the concept of a "cliff". When a cliff applies, all vesting installments prior to the cliff are accrued and accumulated until the cliff occurs.'}),"\n",(0,i.jsx)(n.p,{children:"A cliff only applies in the context of a periodic sequence of vesting installments."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["By convention, a ",(0,i.jsx)(n.code,{children:"CLIFF <duration>"})," is understood to refer to the resolved vesting start."]})}),"\n",(0,i.jsx)(n.h4,{id:"example-simple-cliff",children:"Example: Simple Cliff"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST OVER 4 years EVERY 1 month CLIFF 12 months\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "SINGLETON",\n      "base": {\n        "type": "EVENT",\n        "value": "grantDate"\n      },\n      "offsets": []\n    },\n    "periodicity": {\n      "type": "MONTHS",\n      "length": 1,\n      "occurrences": 48,\n      "cliff": {\n        "type": "SINGLETON",\n        "base": {\n          "type": "EVENT",\n          "value": "vestingStart"\n        },\n        "offsets": [\n          {\n            "type": "DURATION",\n            "value": 12,\n            "unit": "MONTHS",\n            "sign": "PLUS"\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"selectors",children:"Selectors"}),"\n",(0,i.jsx)(n.p,{children:"Selectors select between alternative expressions."}),"\n",(0,i.jsxs)(n.p,{children:["Given the temporal aspect of vesting schedules, a selector can be thought of as either choosing the ",(0,i.jsx)(n.code,{children:"EARLIER OF"})," or ",(0,i.jsx)(n.code,{children:"LATER OF"})," given items. In the case of an ",(0,i.jsx)(n.code,{children:"EARLIER OF"})," selector, the first item to occur is selected. In the case of a ",(0,i.jsx)(n.code,{children:"LATER OF"})," selector, both items must occur, and the later of the items is selected."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that in this way ",(0,i.jsx)(n.code,{children:"EARLIER OF"})," acts as an OR logical operator and ",(0,i.jsx)(n.code,{children:"LATER OF"})," acts as an AND logical operator. However, we have purposefully limited ourselves to the ",(0,i.jsx)(n.code,{children:"EARLIER OF"})," and ",(0,i.jsx)(n.code,{children:"LATER OF"})," nomenclature in order to distinguish selectors from conditions, described below."]}),"\n",(0,i.jsx)(n.h4,{id:"example-vesting-start-with-selector",children:"Example: Vesting Start With Selector"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST FROM EARLIER OF (\n    DATE 2025-01-01,\n    EVENT milestone\n)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "EARLIER_OF",\n      "items": [\n        {\n          "type": "SINGLETON",\n          "base": {\n            "type": "DATE",\n            "value": "2025-01-01"\n          },\n          "offsets": []\n        },\n        {\n          "type": "SINGLETON",\n          "base": {\n            "type": "EVENT",\n            "value": "milestone"\n          },\n          "offsets": []\n        }\n      ]\n    },\n    "periodicity": {\n      "type": "DAYS",\n      "length": 0,\n      "occurrences": 1\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"example-cliff-with-selector",children:"Example: Cliff with Selector"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST\n    OVER 4 years\n    EVERY 1 month\n    CLIFF EARLIER OF (\n        12 months,\n        EVENT ipo\n    )\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "SINGLETON",\n      "base": {\n        "type": "EVENT",\n        "value": "grantDate"\n      },\n      "offsets": []\n    },\n    "periodicity": {\n      "type": "MONTHS",\n      "length": 1,\n      "occurrences": 48,\n      "cliff": {\n        "type": "EARLIER_OF",\n        "items": [\n          {\n            "type": "SINGLETON",\n            "base": {\n              "type": "EVENT",\n              "value": "ipo"\n            },\n            "offsets": []\n          },\n          {\n            "type": "SINGLETON",\n            "base": {\n              "type": "EVENT",\n              "value": "vestingStart"\n            },\n            "offsets": [\n              {\n                "type": "DURATION",\n                "value": 12,\n                "unit": "MONTHS",\n                "sign": "PLUS"\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"conditions",children:"Conditions"}),"\n",(0,i.jsx)(n.p,{children:"Conditons condition one vesting expression on the occurrence of another."}),"\n",(0,i.jsxs)(n.p,{children:["We again leverage the temporal aspect of vesting schedules in order to limit ourselves to ",(0,i.jsx)(n.code,{children:"BEFORE"})," and ",(0,i.jsx)(n.code,{children:"AFTER"})," nomenclature. Any condition can optionally utilize the ",(0,i.jsx)(n.code,{children:"STRICTLY"})," keyword to indicate < or >, respectively."]}),"\n",(0,i.jsxs)(n.p,{children:["In addition, conditions can be combined with ",(0,i.jsx)(n.code,{children:"AND"})," and ",(0,i.jsx)(n.code,{children:"OR"})," operators. We follow SQL like precedence (",(0,i.jsx)(n.code,{children:"AND"})," binds tighter than ",(0,i.jsx)(n.code,{children:"OR"}),", and parentheses override precedence)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST FROM EVENT milestone\n    STRICTLY BEFORE DATE 2025-01-01 AND\n    AFTER EVENT threshold\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "SINGLETON",\n      "base": {\n        "type": "EVENT",\n        "value": "milestone"\n      },\n      "offsets": [],\n      "constraints": {\n        "type": "AND",\n        "items": [\n          {\n            "type": "ATOM",\n            "constraint": {\n              "type": "BEFORE",\n              "base": {\n                "type": "SINGLETON",\n                "base": {\n                  "type": "DATE",\n                  "value": "2025-01-01"\n                },\n                "offsets": []\n              },\n              "strict": true\n            }\n          },\n          {\n            "type": "ATOM",\n            "constraint": {\n              "type": "AFTER",\n              "base": {\n                "type": "SINGLETON",\n                "base": {\n                  "type": "EVENT",\n                  "value": "threshold"\n                },\n                "offsets": []\n              },\n              "strict": false\n            }\n          }\n        ]\n      }\n    },\n    "periodicity": {\n      "type": "DAYS",\n      "length": 0,\n      "occurrences": 1\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"amounts",children:"Amounts"}),"\n",(0,i.jsxs)(n.p,{children:["In vestlang the ",(0,i.jsx)(n.em,{children:"thing"})," that the vesting schedule applies to is left ambiguous. For purposes of this documentation we have discussed vesting schedules in terms of equity-based compensation awards, but in practice it could apply to anything."]}),"\n",(0,i.jsxs)(n.p,{children:["Amounts specify ",(0,i.jsx)(n.strong,{children:"how much"})," of the grant a statement applies to. Integers imply absolute amounts, decimals in [0, 1] imply a percentage, and fractions imply a portion of total statement amount, supplied downstream. If amount is omitted, the default is 100% (1.0)"]}),"\n",(0,i.jsx)(n.h4,{id:"example-omitted-amount",children:"Example: Omitted Amount"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VEST\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "amount": {\n    "type": "PORTION",\n    "numerator": 1,\n    "denominator": 1\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"example-integer-amount",children:"Example: Integer Amount"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"100 VEST\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "amount": {\n    "type": "QUANTITY",\n    "value": 100\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"example-decimal-amount",children:"Example: Decimal Amount"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"0.5 VEST\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "amount": {\n    "type": "PORTION",\n    "numerator": 1,\n    "denominator": 2\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"example-fraction-amount",children:"Example: Fraction Amount"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1/2 VEST\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "amount": {\n    "type": "PORTION",\n    "numerator": 1,\n    "denominator": 2\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"two-tier-vesting-example",children:"Two-Tier Vesting Example"}),"\n",(0,i.jsxs)(n.p,{children:["We can demonstrate the expressiveness of the vestlang DSL and AST by constructing a statement which describes a ",(0,i.jsx)(n.strong,{children:"two-tier vesting schedule"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Two-tier vesting refers to a periodic vesting cadence with a standard time-based cliff, as well as one or more event-based cliffs with expiration dates."}),"\n",(0,i.jsx)(n.p,{children:"The standard two-tier vesting schedule seen in the wild is a 4-year monthly vesting schedule with a 1-year cliff, as well as a cliff on the earlier of an IPO or change in control, so long as the IPO or change in control occurs on prior to the 7th anniversary of the grant date."}),"\n",(0,i.jsxs)(n.p,{children:["This is expressed in vestlang DSL as follows. Note that the ",(0,i.jsx)(n.code,{children:"12 months"})," duration in the cliff statement refers to the resolved vesting start, and we use the ",(0,i.jsx)(n.code,{children:"EVENT grantDAte"})," system event to provide the expiration dates for the cliffs."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-vest",children:"VEST\n    OVER 4 years\n    EVERY 1 month\n    CLIFF LATER OF (\n        12 months,\n        EARLIER OF (\n            EVENT ipo\n                BEFORE EVENT grantDate + 7 years,\n            EVENT cic\n                BEFORE EVENT grantDate + 7 years\n        )\n    )\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expr": {\n    "type": "SINGLETON",\n    "vesting_start": {\n      "type": "SINGLETON",\n      "base": {\n        "type": "EVENT",\n        "value": "grantDate"\n      },\n      "offsets": []\n    },\n    "periodicity": {\n      "type": "MONTHS",\n      "length": 1,\n      "occurrences": 48,\n      "cliff": {\n        "type": "LATER_OF",\n        "items": [\n          {\n            "type": "SINGLETON",\n            "base": {\n              "type": "EVENT",\n              "value": "vestingStart"\n            },\n            "offsets": [\n              {\n                "type": "DURATION",\n                "value": 12,\n                "unit": "MONTHS",\n                "sign": "PLUS"\n              }\n            ]\n          },\n          {\n            "type": "EARLIER_OF",\n            "items": [\n              {\n                "type": "SINGLETON",\n                "base": {\n                  "type": "EVENT",\n                  "value": "CIC"\n                },\n                "offsets": [],\n                "constraints": {\n                  "type": "ATOM",\n                  "constraint": {\n                    "type": "BEFORE",\n                    "base": {\n                      "type": "SINGLETON",\n                      "base": {\n                        "type": "EVENT",\n                        "value": "grantDate"\n                      },\n                      "offsets": [\n                        {\n                          "type": "DURATION",\n                          "value": 84,\n                          "unit": "MONTHS",\n                          "sign": "PLUS"\n                        }\n                      ]\n                    },\n                    "strict": false\n                  }\n                }\n              },\n              {\n                "type": "SINGLETON",\n                "base": {\n                  "type": "EVENT",\n                  "value": "ipo"\n                },\n                "offsets": [],\n                "constraints": {\n                  "type": "ATOM",\n                  "constraint": {\n                    "type": "BEFORE",\n                    "base": {\n                      "type": "SINGLETON",\n                      "base": {\n                        "type": "EVENT",\n                        "value": "grantDate"\n                      },\n                      "offsets": [\n                        {\n                          "type": "DURATION",\n                          "value": 84,\n                          "unit": "MONTHS",\n                          "sign": "PLUS"\n                        }\n                      ]\n                    },\n                    "strict": false\n                  }\n                }\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},6336:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(9430);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);