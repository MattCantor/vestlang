"use strict";(self.webpackChunk_vestlang_docs=self.webpackChunk_vestlang_docs||[]).push([[462],{7970:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>Rt,contentTitle:()=>Lt,default:()=>Dt,frontMatter:()=>wt,metadata:()=>r,toc:()=>_t});const r=JSON.parse('{"id":"playground","title":"Playground","description":"","source":"@site/docs/playground.mdx","sourceDirName":".","slug":"/playground","permalink":"/vestlang/playground","draft":false,"unlisted":false,"editUrl":"https://github.com/MattCantor/vestlang/docs/playground.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Playground","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Command Line Interface","permalink":"/vestlang/cli"}}');var s=n(5270),a=n(7678),o=n(9430),i=n(9807);class c extends SyntaxError{constructor(t,e,n,r){super(t),this.expected=e,this.found=n,this.location=r,this.name="SyntaxError"}format(t){let e="Error: "+this.message;if(this.location){let n=null;const r=t.find(t=>t.source===this.location.source);r&&(n=r.text.split(/\r\n|\n|\r/g));const s=this.location.start,a=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,o=this.location.source+":"+a.line+":"+a.column;if(n){const t=this.location.end,r="".padEnd(a.line.toString().length," "),i=n[s.line-1],c=(s.line===t.line?t.column:i.length+1)-s.column||1;e+="\n --\x3e "+o+"\n"+r+" |\n"+a.line+" | "+i+"\n"+r+" | "+"".padEnd(s.column-1," ")+"".padEnd(c,"^")}else e+="\n at "+o}return e}static buildMessage(t,e){function n(t){return t.codePointAt(0).toString(16).toUpperCase()}const r=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function s(t){return r?t.replace(r,t=>"\\u{"+n(t)+"}"):t}function a(t){return s(t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+n(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+n(t)))}function o(t){return s(t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+n(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+n(t)))}const i={literal:t=>'"'+a(t.text)+'"',class(t){const e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e.join("")+"]"+(t.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:t=>t.description};function c(t){return i[t.type](t)}return"Expected "+function(t){const e=t.map(c);if(e.sort(),e.length>0){let t=1;for(let n=1;n<e.length;n++)e[n-1]!==e[n]&&(e[t]=e[n],t++);e.length=t}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+function(t){return t?'"'+a(t)+'"':"end of input"}(e)+" found."}}function l(t,e){const n={},r=(e=void 0!==e?e:{}).grammarSource,s={Start:Wt};let a=Wt;const o="vest",i="[",l="]",u="and",f="or",d=",",p=".",m="/",h="day",E="s",g="month",y="week",b="year",v="strictly",x="date",N="-",O="grantdate",S="grant_date",A="grant-date",w="vestingstart",L="vesting_start",R="vesting-start",_="event",T="before",D="after",C="(",I=")",j="earlier",M="later",U="of",V="over",k="every",F="from",$="cliff",P=/^[ \t\r\n]/,Y=/^[+\-]/,B=/^[0-9]/,G=/^[0-1]/,z=/^[A-Za-z_]/,H=/^[A-Za-z0-9_]/,K=/^[0-3]/,Q=Gt("VEST",!0),J=Gt("[",!1),W=Gt("]",!1),Z={type:"any"},q=zt([" ","\t","\r","\n"],!1,!1,!1),X=Gt("AND",!0),tt=Gt("OR",!0),et=Gt(",",!1),nt=zt(["+","-"],!1,!1,!1),rt=zt([["0","9"]],!1,!1,!1),st=Gt(".",!1),at=zt([["0","1"]],!1,!1,!1),ot=Gt("/",!1),it=Gt("day",!0),ct=Gt("s",!1),lt=Gt("month",!0),ut=Gt("week",!0),ft=Gt("year",!0),dt=zt([["A","Z"],["a","z"],"_"],!1,!1,!1),pt=zt([["A","Z"],["a","z"],["0","9"],"_"],!1,!1,!1),mt=Gt("STRICTLY",!0),ht=Gt("DATE",!0),Et=Gt("-",!1),gt=zt([["0","3"]],!1,!1,!1),yt=Gt("grantdate",!0),bt=Gt("grant_date",!0),vt=Gt("grant-date",!0),xt=Gt("vestingstart",!0),Nt=Gt("vesting_start",!0),Ot=Gt("vesting-start",!0),St=Gt("EVENT",!0),At=Gt("BEFORE",!0),wt=Gt("AFTER",!0),Lt=Gt("(",!1),Rt=Gt(")",!1),_t=Gt("EARLIER",!0),Tt=Gt("LATER",!0),Dt=Gt("OF",!0),Ct=Gt("OVER",!0),It=Gt("EVERY",!0),jt=Gt("FROM",!0),Mt=Gt("CLIFF",!0);let Ut=0|e.peg$currPos,Vt=Ut;const kt=[{line:1,column:1}];let Ft,$t=Ut,Pt=e.peg$maxFailExpected||[],Yt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=s[e.startRule]}function Bt(t,e){throw function(t,e){return new c(t,null,null,e)}(t,e=void 0!==e?e:Kt(Vt,Ut))}function Gt(t,e){return{type:"literal",text:t,ignoreCase:e}}function zt(t,e,n,r){return{type:"class",parts:t,inverted:e,ignoreCase:n,unicode:r}}function Ht(e){let n,r=kt[e];if(r)return r;if(e>=kt.length)n=kt.length-1;else for(n=e;!kt[--n];);for(r=kt[n],r={line:r.line,column:r.column};n<e;)10===t.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return kt[e]=r,r}function Kt(t,e,n){const s=Ht(t),a=Ht(e),o={source:r,start:{offset:t,line:s.line,column:s.column},end:{offset:e,line:a.line,column:a.column}};return n&&r&&"function"==typeof r.offset&&(o.start=r.offset(o.start),o.end=r.offset(o.end)),o}function Qt(t){Ut<$t||(Ut>$t&&($t=Ut,Pt=[]),Pt.push(t))}function Jt(t,e,n){return new c(c.buildMessage(t,e),t,e,n)}function Wt(){let e,r,s,a,o;return e=Ut,r=qt(),s=Ut,a=function(){let e,r,s,a,o,c,u,f,d;e=Ut,91===t.charCodeAt(Ut)?(r=i,Ut++):(r=n,0===Yt&&Qt(J));if(r!==n)if(s=qt(),a=Zt(),a!==n){for(o=[],c=Ut,u=ee(),u!==n?(f=Zt(),f!==n?(u=[u,f],c=u):(Ut=c,c=n)):(Ut=c,c=n);c!==n;)o.push(c),c=Ut,u=ee(),u!==n?(f=Zt(),f!==n?(u=[u,f],c=u):(Ut=c,c=n)):(Ut=c,c=n);c=qt(),u=ee(),u===n&&(u=null),f=qt(),93===t.charCodeAt(Ut)?(d=l,Ut++):(d=n,0===Yt&&Qt(W)),d!==n?(Vt=e,e=Ne(a,o)):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;return e}(),a!==n&&(Vt=s),s=a,s===n&&(s=Ut,a=Zt(),a!==n&&(Vt=s,a=[a]),s=a),s!==n?(a=qt(),o=function(){let e,r;e=Ut,Yt++,t.length>Ut?(r=t.charAt(Ut),Ut++):(r=n,0===Yt&&Qt(Z));Yt--,r===n?e=void 0:(Ut=e,e=n);return e}(),o!==n?(Vt=e,e=s):(Ut=e,e=n)):(Ut=e,e=n),e}function Zt(){let e,r,s,a,i,c,l,u;var f;return e=Ut,r=qt(),s=function(){let e,r,s,a;e=Ut,r=qt(),s=function(){let e,r;e=Ut,r=function(){let e,r,s,a,o,i,c;e=Ut,r=Ut,s=Ut,46===t.charCodeAt(Ut)?(a=p,Ut++):(a=n,0===Yt&&Qt(st));if(a!==n){if(o=[],i=t.charAt(Ut),B.test(i)?Ut++:(i=n,0===Yt&&Qt(rt)),i!==n)for(;i!==n;)o.push(i),i=t.charAt(Ut),B.test(i)?Ut++:(i=n,0===Yt&&Qt(rt));else o=n;o!==n?(a=[a,o],s=a):(Ut=s,s=n)}else Ut=s,s=n;if(s===n)if(s=Ut,a=t.charAt(Ut),G.test(a)?Ut++:(a=n,0===Yt&&Qt(at)),a!==n)if(46===t.charCodeAt(Ut)?(o=p,Ut++):(o=n,0===Yt&&Qt(st)),o!==n){if(i=[],c=t.charAt(Ut),B.test(c)?Ut++:(c=n,0===Yt&&Qt(rt)),c!==n)for(;c!==n;)i.push(c),c=t.charAt(Ut),B.test(c)?Ut++:(c=n,0===Yt&&Qt(rt));else i=n;i!==n?(a=[a,o,i],s=a):(Ut=s,s=n)}else Ut=s,s=n;else Ut=s,s=n;r=s!==n?t.substring(r,Ut):s;r!==n&&(Vt=e);return e=r,e}(),r!==n&&(Vt=e,r=function(t){const e=parseFloat(t);(e<0||e>1)&&Bt("Decimal portion must be between 0 and 1 inclusive");const n=((t.startsWith(".")?["0",t.slice(1)]:t.split("."))[1]??"").length,r=Math.pow(10,n);return ve(Math.round(e*r),r)}(r));return e=r,e}(),s===n&&(s=function(){let e,r,s,a,o,i;e=Ut,r=ne(),r!==n?(s=qt(),47===t.charCodeAt(Ut)?(a=m,Ut++):(a=n,0===Yt&&Qt(ot)),a!==n?(o=qt(),i=ne(),i!==n?(Vt=e,e=ve(r,i)):(Ut=e,e=n)):(Ut=e,e=n)):(Ut=e,e=n);return e}(),s===n&&(s=function(){let t,e;t=Ut,e=ne(),e!==n&&(Vt=t,e={type:"QUANTITY",value:e});return t=e,t}()));s!==n?(a=qt(),Vt=e,e=s):(Ut=e,e=n);return e}(),s===n&&(s=null),a=qt(),i=t.substr(Ut,4),i.toLowerCase()===o?Ut+=4:(i=n,0===Yt&&Qt(Q)),i!==n?(c=qt(),l=ge(),l!==n?(u=qt(),Vt=e,f=l,e={amount:s??ve(1,1),expr:f}):(Ut=e,e=n)):(Ut=e,e=n),e}function qt(){let e,r;for(e=[],r=t.charAt(Ut),P.test(r)?Ut++:(r=n,0===Yt&&Qt(q));r!==n;)e.push(r),r=t.charAt(Ut),P.test(r)?Ut++:(r=n,0===Yt&&Qt(q));return e}function Xt(){let e,r,s,a;return e=Ut,r=qt(),s=t.substr(Ut,3),s.toLowerCase()===u?Ut+=3:(s=n,0===Yt&&Qt(X)),s!==n?(a=qt(),Vt=e,e="AND"):(Ut=e,e=n),e}function te(){let e,r,s,a;return e=Ut,r=qt(),s=t.substr(Ut,2),s.toLowerCase()===f?Ut+=2:(s=n,0===Yt&&Qt(tt)),s!==n?(a=qt(),Vt=e,e="OR"):(Ut=e,e=n),e}function ee(){let e,r,s,a;return e=Ut,r=qt(),44===t.charCodeAt(Ut)?(s=d,Ut++):(s=n,0===Yt&&Qt(et)),s!==n?(a=qt(),r=[r,s,a],e=r):(Ut=e,e=n),e}function ne(){let e,r,s,a;if(e=Ut,r=Ut,s=[],a=t.charAt(Ut),B.test(a)?Ut++:(a=n,0===Yt&&Qt(rt)),a!==n)for(;a!==n;)s.push(a),a=t.charAt(Ut),B.test(a)?Ut++:(a=n,0===Yt&&Qt(rt));else s=n;return r=s!==n?t.substring(r,Ut):s,r!==n?(s=Ut,Yt++,46===t.charCodeAt(Ut)?(a=p,Ut++):(a=n,0===Yt&&Qt(st)),Yt--,a===n?s=void 0:(Ut=s,s=n),s!==n?(Vt=e,e=parseInt(r,10)):(Ut=e,e=n)):(Ut=e,e=n),e}function re(){let e,r,s,a,o,i;return e=Ut,r=function(){let e;return e=t.charAt(Ut),Y.test(e)?Ut++:(e=n,0===Yt&&Qt(nt)),e}(),r===n&&(r=null),s=qt(),a=ne(),a!==n?(o=qt(),i=function(){let e,r,s;e=Ut,r=t.substr(Ut,3),r.toLowerCase()===h?Ut+=3:(r=n,0===Yt&&Qt(it));r!==n?(115===t.charCodeAt(Ut)?(s=E,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="DAYS"):(Ut=e,e=n);e===n&&(e=Ut,r=t.substr(Ut,5),r.toLowerCase()===g?Ut+=5:(r=n,0===Yt&&Qt(lt)),r!==n?(115===t.charCodeAt(Ut)?(s=E,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="MONTHS"):(Ut=e,e=n),e===n&&(e=Ut,r=t.substr(Ut,4),r.toLowerCase()===y?Ut+=4:(r=n,0===Yt&&Qt(ut)),r!==n?(115===t.charCodeAt(Ut)?(s=E,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="weeks"):(Ut=e,e=n),e===n&&(e=Ut,r=t.substr(Ut,4),r.toLowerCase()===b?Ut+=4:(r=n,0===Yt&&Qt(ft)),r!==n?(115===t.charCodeAt(Ut)?(s=E,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="years"):(Ut=e,e=n))));return e}(),i!==n?(Vt=e,e=function(t,e,n){const r="-"===t?"MINUS":"PLUS";switch(n){case"weeks":return ye(7*e,"DAYS",r);case"years":return ye(12*e,"MONTHS",r);case"DAYS":case"MONTHS":return ye(e,n,r);default:Bt("Unknown duration unit: "+n)}}(r,a,i)):(Ut=e,e=n)):(Ut=e,e=n),e}function se(){let e,r,s,a;return e=Ut,r=t.substr(Ut,5),r.toLowerCase()===_?Ut+=5:(r=n,0===Yt&&Qt(St)),r!==n?(s=qt(),a=function(){let e,r;return e=Ut,r=t.substr(Ut,9),r.toLowerCase()===O?Ut+=9:(r=n,0===Yt&&Qt(yt)),r!==n&&(Vt=e,r="grantDate"),e=r,e===n&&(e=Ut,r=t.substr(Ut,10),r.toLowerCase()===S?Ut+=10:(r=n,0===Yt&&Qt(bt)),r!==n&&(Vt=e,r="grantDate"),e=r,e===n&&(e=Ut,r=t.substr(Ut,10),r.toLowerCase()===A?Ut+=10:(r=n,0===Yt&&Qt(vt)),r!==n&&(Vt=e,r="grantDate"),e=r,e===n&&(e=Ut,r=t.substr(Ut,12),r.toLowerCase()===w?Ut+=12:(r=n,0===Yt&&Qt(xt)),r!==n&&(Vt=e,r="vestingStart"),e=r,e===n&&(e=Ut,r=t.substr(Ut,13),r.toLowerCase()===L?Ut+=13:(r=n,0===Yt&&Qt(Nt)),r!==n&&(Vt=e,r="vestingStart"),e=r,e===n&&(e=Ut,r=t.substr(Ut,13),r.toLowerCase()===R?Ut+=13:(r=n,0===Yt&&Qt(Ot)),r!==n&&(Vt=e,r="vestingStart"),e=r))))),e}(),a===n&&(a=function(){let e,r,s,a,o;if(e=Ut,r=Ut,s=t.charAt(Ut),z.test(s)?Ut++:(s=n,0===Yt&&Qt(dt)),s!==n){for(a=[],o=t.charAt(Ut),H.test(o)?Ut++:(o=n,0===Yt&&Qt(pt));o!==n;)a.push(o),o=t.charAt(Ut),H.test(o)?Ut++:(o=n,0===Yt&&Qt(pt));s=[s,a],r=s}else Ut=r,r=n;return e=r!==n?t.substring(e,Ut):r,e}()),a!==n?(Vt=e,e=function(t){return{type:"EVENT",value:t}}(a)):(Ut=e,e=n)):(Ut=e,e=n),e}function ae(){let e,r,s,a,o,i;if(e=Ut,r=se(),r===n&&(r=function(){let e,r,s,a,o,i,c,l,u,f,d,p,m,h,E;return e=Ut,r=t.substr(Ut,4),r.toLowerCase()===x?Ut+=4:(r=n,0===Yt&&Qt(ht)),r!==n?(s=qt(),a=Ut,o=Ut,i=t.charAt(Ut),B.test(i)?Ut++:(i=n,0===Yt&&Qt(rt)),i!==n?(c=t.charAt(Ut),B.test(c)?Ut++:(c=n,0===Yt&&Qt(rt)),c!==n?(l=t.charAt(Ut),B.test(l)?Ut++:(l=n,0===Yt&&Qt(rt)),l!==n?(u=t.charAt(Ut),B.test(u)?Ut++:(u=n,0===Yt&&Qt(rt)),u!==n?(45===t.charCodeAt(Ut)?(f=N,Ut++):(f=n,0===Yt&&Qt(Et)),f!==n?(d=t.charAt(Ut),G.test(d)?Ut++:(d=n,0===Yt&&Qt(at)),d!==n?(p=t.charAt(Ut),B.test(p)?Ut++:(p=n,0===Yt&&Qt(rt)),p!==n?(45===t.charCodeAt(Ut)?(m=N,Ut++):(m=n,0===Yt&&Qt(Et)),m!==n?(h=t.charAt(Ut),K.test(h)?Ut++:(h=n,0===Yt&&Qt(gt)),h!==n?(E=t.charAt(Ut),B.test(E)?Ut++:(E=n,0===Yt&&Qt(rt)),E!==n?(i=[i,c,l,u,f,d,p,m,h,E],o=i):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n)):(Ut=o,o=n),a=o!==n?t.substring(a,Ut):o,a!==n?(Vt=e,g=a,e={type:"DATE",value:g}):(Ut=e,e=n)):(Ut=e,e=n),e;var g}()),r!==n){for(s=[],a=Ut,o=qt(),i=re(),i!==n?(o=[o,i],a=o):(Ut=a,a=n);a!==n;)s.push(a),a=Ut,o=qt(),i=re(),i!==n?(o=[o,i],a=o):(Ut=a,a=n);a=Ut,o=qt(),i=ue(),i!==n?(o=[o,i],a=o):(Ut=a,a=n),a===n&&(a=null),Vt=e,e=function(t,e,n){const r={type:"SINGLETON",base:t,offsets:be(e.map(t=>t[1]))};return n&&(r.constraints=n[1]),r}(r,s,a)}else Ut=e,e=n;return e}function oe(){let e,r,s,a,o,i;var c,l;return e=Ut,r=function(){let e,r;return e=Ut,r=t.substr(Ut,8),r.toLowerCase()===v?Ut+=8:(r=n,0===Yt&&Qt(mt)),r!==n&&(Vt=e,r=!0),e=r,e}(),r===n&&(r=null),s=qt(),a=t.substr(Ut,6),a.toLowerCase()===T?Ut+=6:(a=n,0===Yt&&Qt(At)),a===n&&(a=t.substr(Ut,5),a.toLowerCase()===D?Ut+=5:(a=n,0===Yt&&Qt(wt))),a!==n?(o=qt(),i=ae(),i!==n?(Vt=e,c=r,l=i,e={type:"ATOM",constraint:{type:a.toUpperCase(),base:l,strict:!!c}}):(Ut=e,e=n)):(Ut=e,e=n),e}function ie(){let e,r,s,a,o,i,c,l,d;if(e=Ut,r=t.substr(Ut,3),r.toLowerCase()===u?Ut+=3:(r=n,0===Yt&&Qt(X)),r===n&&(r=t.substr(Ut,2),r.toLowerCase()===f?Ut+=2:(r=n,0===Yt&&Qt(tt))),r!==n)if(40===t.charCodeAt(Ut)?(s=C,Ut++):(s=n,0===Yt&&Qt(Lt)),s!==n)if(a=qt(),o=ue(),o!==n){for(i=[],c=Ut,l=ee(),l!==n?(d=ue(),d!==n?(l=[l,d],c=l):(Ut=c,c=n)):(Ut=c,c=n);c!==n;)i.push(c),c=Ut,l=ee(),l!==n?(d=ue(),d!==n?(l=[l,d],c=l):(Ut=c,c=n)):(Ut=c,c=n);c=qt(),41===t.charCodeAt(Ut)?(l=I,Ut++):(l=n,0===Yt&&Qt(Rt)),l!==n?(Vt=e,p=o,m=i,e=Oe(r.toUpperCase(),xe(p,m))):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;var p,m;return e}function ce(){let e;return e=function(){let e,r,s,a,o,i;return e=Ut,40===t.charCodeAt(Ut)?(r=C,Ut++):(r=n,0===Yt&&Qt(Lt)),r!==n?(s=qt(),a=ue(),a!==n?(o=qt(),41===t.charCodeAt(Ut)?(i=I,Ut++):(i=n,0===Yt&&Qt(Rt)),i!==n?(Vt=e,e=a):(Ut=e,e=n)):(Ut=e,e=n)):(Ut=e,e=n),e}(),e===n&&(e=ie(),e===n&&(e=oe())),e}function le(){let t,e,r,s,a,o;if(t=Ut,e=ce(),e!==n){for(r=[],s=Ut,a=Xt(),a!==n?(o=ce(),o!==n?(a=[a,o],s=a):(Ut=s,s=n)):(Ut=s,s=n);s!==n;)r.push(s),s=Ut,a=Xt(),a!==n?(o=ce(),o!==n?(a=[a,o],s=a):(Ut=s,s=n)):(Ut=s,s=n);Vt=t,i=e,t=0===(c=r).length?i:Oe("AND",xe(i,c))}else Ut=t,t=n;var i,c;return t}function ue(){let t,e,r,s,a,o;if(t=Ut,e=le(),e!==n){for(r=[],s=Ut,a=te(),a!==n?(o=le(),o!==n?(a=[a,o],s=a):(Ut=s,s=n)):(Ut=s,s=n);s!==n;)r.push(s),s=Ut,a=te(),a!==n?(o=le(),o!==n?(a=[a,o],s=a):(Ut=s,s=n)):(Ut=s,s=n);Vt=t,i=e,t=0===(c=r).length?i:Oe("OR",xe(i,c))}else Ut=t,t=n;var i,c;return t}function fe(){let e;return e=function(){let e,r,s,a,o,i,c,l,u,f,d,p;e=Ut,r=t.substr(Ut,7),r.toLowerCase()===j?Ut+=7:(r=n,0===Yt&&Qt(_t));r===n&&(r=t.substr(Ut,5),r.toLowerCase()===M?Ut+=5:(r=n,0===Yt&&Qt(Tt)));if(r!==n)if(s=qt(),a=t.substr(Ut,2),a.toLowerCase()===U?Ut+=2:(a=n,0===Yt&&Qt(Dt)),a!==n)if(o=qt(),40===t.charCodeAt(Ut)?(i=C,Ut++):(i=n,0===Yt&&Qt(Lt)),i!==n)if(c=qt(),l=fe(),l!==n){for(u=[],f=Ut,d=ee(),d!==n?(p=fe(),p!==n?(d=[d,p],f=d):(Ut=f,f=n)):(Ut=f,f=n);f!==n;)u.push(f),f=Ut,d=ee(),d!==n?(p=fe(),p!==n?(d=[d,p],f=d):(Ut=f,f=n)):(Ut=f,f=n);f=qt(),41===t.charCodeAt(Ut)?(d=I,Ut++):(d=n,0===Yt&&Qt(Rt)),d!==n?(Vt=e,m=l,h=u,e={type:"EARLIER"===r.toUpperCase()?"EARLIER_OF":"LATER_OF",items:Ne(m,h)}):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;var m,h;return e}(),e===n&&(e=ae(),e===n&&(e=re())),e}function de(){let e,r,s,a;var o;return e=Ut,r=t.substr(Ut,4),r.toLowerCase()===V?Ut+=4:(r=n,0===Yt&&Qt(Ct)),r!==n?(s=qt(),a=re(),a!==n?(Vt=e,"MINUS"===(o=a).sign&&Bt("OVER may not include a negative duration"),e=o):(Ut=e,e=n)):(Ut=e,e=n),e}function pe(){let e,r,s,a;var o;return e=Ut,r=t.substr(Ut,5),r.toLowerCase()===k?Ut+=5:(r=n,0===Yt&&Qt(It)),r!==n?(s=qt(),a=re(),a!==n?(Vt=e,"MINUS"===(o=a).sign&&Bt("EVERY may not include a negative duration"),e=o):(Ut=e,e=n)):(Ut=e,e=n),e}function me(){let t,e,r,s;return t=Ut,e=de(),e!==n?(r=qt(),s=pe(),s!==n?(Vt=t,t=function(t,e){t.unit!==e.unit&&Bt("EVERY and OVER must have the same units");const n=t.value,r=e.value;return 0===n&&0!==r&&Bt("EVERY must be non-zero when OVER is non-zero"),0===r&&0!==n&&Bt("OVER must be non-zero when EVERY is non-zero"),0===n&&0===r?{type:"DAYS",length:0,occurrences:1}:(n%r!==0&&Bt("OVER must be a multiple of every"),{type:t.unit,length:r,occurrences:n/r})}(e,s)):(Ut=t,t=n)):(Ut=t,t=n),t===n&&(t=Ut,e=de(),e!==n&&(Vt=t,e=void Bt("EVERY must be provided when OVER is present")),t=e,t===n&&(t=Ut,e=pe(),e!==n&&(Vt=t,e=void Bt("OVER must be provided when EVERY is present")),t=e,t===n&&(t=Ut,e="",Vt=t,e={type:"DAYS",length:0,occurrences:1},t=e))),t}function he(){let e,r,s,a;return e=Ut,r=t.substr(Ut,4),r.toLowerCase()===F?Ut+=4:(r=n,0===Yt&&Qt(jt)),r!==n?(s=qt(),a=ae(),a===n&&(a=fe()),a!==n?(Vt=e,e=function(t){if("SINGLETON"===t.type&&"EVENT"===t.base.type&&"vestingStart"===t.base.value)throw new SyntaxError("vestingStart is a reserved system event that cannot be used in a `FROM` statement. Pick a different event name.");return t}(a)):(Ut=e,e=n)):(Ut=e,e=n),e}function Ee(){let e,r,s,a;return e=Ut,r=t.substr(Ut,5),r.toLowerCase()===$?Ut+=5:(r=n,0===Yt&&Qt(Mt)),r!==n?(s=qt(),a=ae(),a===n&&(a=fe()),a!==n?(Vt=e,e=function(t){if("SINGLETONE"===t.type&&"EVENT"===t.base.type&&"grantDate"===t.base.value)throw new SyntaxError("grantDate is a reserved system event that cannot be used in a `CLIFF` statement. The `CLIFF` will refer to the computed `vestingStart` date, unless an alternative event is provided.");return t}(a)):(Ut=e,e=n)):(Ut=e,e=n),e}function ge(){let e;return e=function(){let e,r,s,a,o,i,c,l,u,f,d,p;e=Ut,r=t.substr(Ut,7),r.toLowerCase()===j?Ut+=7:(r=n,0===Yt&&Qt(_t));r===n&&(r=t.substr(Ut,5),r.toLowerCase()===M?Ut+=5:(r=n,0===Yt&&Qt(Tt)));if(r!==n)if(s=qt(),a=t.substr(Ut,2),a.toLowerCase()===U?Ut+=2:(a=n,0===Yt&&Qt(Dt)),a!==n)if(o=qt(),40===t.charCodeAt(Ut)?(i=C,Ut++):(i=n,0===Yt&&Qt(Lt)),i!==n)if(c=qt(),l=ge(),l!==n){for(u=[],f=Ut,d=ee(),d!==n?(p=ge(),p!==n?(d=[d,p],f=d):(Ut=f,f=n)):(Ut=f,f=n);f!==n;)u.push(f),f=Ut,d=ee(),d!==n?(p=ge(),p!==n?(d=[d,p],f=d):(Ut=f,f=n)):(Ut=f,f=n);f=qt(),41===t.charCodeAt(Ut)?(d=I,Ut++):(d=n,0===Yt&&Qt(Rt)),d!==n?(Vt=e,m=l,h=u,e={type:"EARLIER"===r.toUpperCase()?"EARLIER_OF":"LATER_OF",items:Ne(m,h)}):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;var m,h;return e}(),e===n&&(e=function(){let t,e,r,s,a,o;return t=Ut,e=he(),e===n&&(e=null),r=qt(),s=me(),s!==n?(a=qt(),o=Ee(),o===n&&(o=null),Vt=t,t=function(t,e,n){const r={type:"SINGLETON",vesting_start:t,periodicity:e};return n&&(r.periodicity.cliff=n),r}(e,s,o)):(Ut=t,t=n),t}()),e}function ye(t,e,n){return{type:"DURATION",value:t,unit:e,sign:n}}function be(t){if(!t||0===t.length)return[];let e=0,n=0;for(const s of t){const t=Math.abs(s.value),r="MINUS"===s.sign?-t:t;if("MONTHS"===s.unit)e+=r;else{if("DAYS"!==s.unit)throw new SyntaxError(`Unknown offset type ${s.unit}`);n+=r}}const r=[];return 0!==e&&r.push(ye(Math.abs(e),"MONTHS",e<0?"MINUS":"PLUS")),0!==n&&r.push(ye(Math.abs(n),"DAYS",n<0?"MINUS":"PLUS")),r}function ve(t,e){if(0===e)throw new SyntaxError("Denominator cannot be 0");e<0&&(t=-t,e=-e);const n=function(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){const n=t%e;t=e,e=n}return t||1}(Math.abs(t),e);return{type:"PORTION",numerator:t/n,denominator:e/n}}function xe(t,e){return[t,...e.map(t=>t[1])]}function Ne(t,e){const n=xe(t,e);if(n.length<2)throw new SyntaxError("At least two items are required");return n}function Oe(t,e){const n=t.toUpperCase(),r=[];for(const s of e)s&&s.type===n&&Array.isArray(s.items)?r.push(...s.items):r.push(s);if(1===r.length)return r[0];if(r.length<2)throw new SyntaxError(`${n} requires at least two items`);return{type:n,items:r}}Ft=a();const Se=Ft!==n&&Ut===t.length;function Ae(){throw Ft!==n&&Ut<t.length&&Qt({type:"end"}),Jt(Pt,$t<t.length?function(e=Ut){const n=t.codePointAt(e);return void 0===n?"":String.fromCodePoint(n)}($t):null,$t<t.length?Kt($t,$t+1):Kt($t,$t))}return e.peg$library?{peg$result:Ft,peg$currPos:Ut,peg$FAILED:n,peg$maxFailExpected:Pt,peg$maxFailPos:$t,peg$success:Se,peg$throw:Se?void 0:Ae}:Se?Ft:void Ae()}function u(t){const e=new WeakSet,n=t=>{if(null===t||"object"!=typeof t)return t;if(e.has(t))return"[Circular]";if(e.add(t),Array.isArray(t))return t.map(n);const r=Object.keys(t).sort(),s={};for(const e of r)s[e]=n(t[e]);return s};return JSON.stringify(n(t))}function f(t,e){let n=t.items.map(e);if(n=n.flatMap(e=>e.type===t.type?e.items:[e]),n.sort((t,e)=>u(t).localeCompare(u(e))),n=function(t){const e=new Set,n=[];for(const r of t){const t=u(r);e.has(t)||(e.add(t),n.push(r))}return n}(n),1===n.length)return n[0];if(0===n.length)throw new Error(`${t.type} became empty after normalization`);return{...t,items:n}}function d(t){return t.constraints?{...t,constraints:p(t.constraints)}:t}function p(t){switch(t.type){case"ATOM":return function(t){const e=d(t.constraint.base);return{type:"ATOM",constraint:{...t.constraint,base:e}}}(t);case"AND":case"OR":return f(t,p);default:throw new Error(`normalizeCondition: unexpected condition type ${t?.type}`)}}function m(t){return{amount:t.amount,expr:h(t.expr)}}function h(t){switch(t.type){case"SINGLETON":return function(t){const e=g(t.vesting_start??{type:"SINGLETON",base:{type:"EVENT",value:"grantDate"},offsets:[]}),n=t.periodicity.cliff?{...t.periodicity,cliff:y(t.periodicity.cliff)}:{...t.periodicity};return{...t,vesting_start:e,periodicity:n}}(t);case"EARLIER_OF":case"LATER_OF":return f(t,h);default:throw new Error(`normalizeScheduleExpr: unexpected ScheduleExpr type ${t?.type}`)}}function E(t,e){switch(t.type){case"DURATION":return{type:"SINGLETON",base:{type:"EVENT",value:e},offsets:[t]};case"LATER_OF":case"EARLIER_OF":return f(t,"grantDate"===e?g:y);case"SINGLETON":return b(t);default:throw new Error(`normalizeCliff: unexpected cliff type ${t?.type}`)}}function g(t){return E(t,"grantDate")}function y(t){return E(t,"vestingStart")}function b(t){switch(t.type){case"SINGLETON":return d(t);case"EARLIER_OF":case"LATER_OF":return f(t,b);default:throw new Error(`normalizeVestingNodeExpr: unexpected VestingNode type ${t?.type}`)}}var v=n(7824),x=n(6053),N=n(8398),O=n(9944);const S=t=>new Date(t+"T00:00:00Z"),A=t=>t.toISOString().slice(0,10);function w(t,e,n){const r=S(t),s=r.getUTCFullYear(),a=r.getUTCMonth()+e,o=s+Math.floor(a/12),i=(a%12+12)%12,c=new Date(Date.UTC(o,i+1,0)).getUTCDate(),l=new Date(Date.UTC(o,i,(()=>{switch(n.vesting_day_of_month){case"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH":return Math.min(r.getUTCDate(),c);case"29_OR_LAST_DAY_OF_MONTH":return Math.min(29,c);case"30_OR_LAST_DAY_OF_MONTH":return Math.min(30,c);case"31_OR_LAST_DAY_OF_MONTH":return Math.min(31,c);default:return Math.min(parseInt(n.vesting_day_of_month,10),c)}})()));return A(l)}const L=(t,e)=>A((0,v.f)(S(t),e)),R=(t,e)=>(0,x.Y)(S(t),S(e)),_=(t,e)=>(0,N.d)(S(t),S(e)),T=(t,e)=>(0,O.n)(S(t),S(e));function D(t,e,n,r){return"MONTHS"===e?w(t,n,r):L(t,n)}function C(t){return!!t&&"object"==typeof t&&"PICKED"===t.type&&"RESOLVED"===t.meta.type}function I(t,e,n=!0){switch(t.base.type){case"DATE":const r=j(t.base.value,t.offsets,e);return n&&_(r,e.asOf)?{type:"UNRESOLVED",blockers:[{type:"DATE_NOT_YET_OCCURRED",date:r}]}:{type:"RESOLVED",date:j(t.base.value,t.offsets,e)};case"EVENT":const s=e.events[t.base.value];return s?{type:"RESOLVED",date:j(s,t.offsets,e)}:{type:"UNRESOLVED",blockers:[{type:"EVENT_NOT_YET_OCCURRED",event:t.base.value}]}}}function j(t,e,n){let r=t;for(const s of e)r="MONTHS"===s.unit?w(r,"PLUS"===s.sign?s.value:-s.value,n):L(r,"PLUS"===s.sign?s.value:-s.value);return r}const M=t=>({type:"IMPOSSIBLE_CONDITION",condition:{base:t.base,offsets:t.offsets,constraints:t.constraints}}),U=t=>{throw new Error(`Unhandled case: ${String(t)}`)},V=(t,e,n,r)=>{const s=R(n,r),a=T(n,r),o=_(n,r);return"BEFORE"===t?e?!s:!(s||a):"AFTER"===t?e?!o:!(o||a):U(t)},k=(t,e)=>[...t.map(t=>t.blockers).flat(),{type:"UNRESOLVED_CONDITION",condition:e}];function F(t,e,n,r){switch(n.type){case"ATOM":const s=I(n.constraint.base,r);return function(t,e,n){const{constraint:r}=n.constraints,s=r.strict;if("IMPOSSIBLE"===e.type)return"BEFORE"==r.type?"UNRESOLVED"===t.type?k([t,e],n):void 0:[M(n)];if("UNRESOLVED"===t.type&&"UNRESOLVED"===e.type)return k([t,e],n);if("RESOLVED"===t.type&&"UNRESOLVED"===e.type){if("BEFORE"===r.type)return;return[M(n)]}if("UNRESOLVED"===t.type&&"RESOLVED"===e.type)return"BEFORE"===r.type?[M(n)]:k([t],n);if("RESOLVED"===t.type&&"RESOLVED"===e.type){const a=t.date,o=e.date;return V(r.type,s,a,o)?[M(n)]:void 0}return U(t)}(e,s,t);case"AND":return n.items.reduce((n,s)=>{const a=F({...t,constraints:s},e,s,r);return a?(n.push(...a),n):n},[]);case"OR":let a=!1;const o=[];for(const i of n.items){const n=F({...t,constraints:i},e,i,r);n&&0!==n.length?o.push(...n):a=!0}if(a)return;return o}}function $(t){const e=[];for(const n of t)"PICKED"!==n.type&&e.push(...n.blockers);return e}function P(t){const e=[];for(const n of t)"IMPOSSIBLE"===n.type&&e.push(...n.blockers);return e}function Y(t,e){let n=t[0].meta,r=t[0].picked;return t.forEach(t=>{const s=function(t,e,n){return("EARLIER_OF"===n?R(e.date,t.date):R(t.date,e.date))?e:t}(n,t.meta,e);s===t.meta&&(r=t.picked),n=s}),{picked:r,meta:n}}const B={selector:"EARLIER_OF",selectorIsSatisfied:t=>t.some(C),partialEmit:!1},G={selector:"LATER_OF",selectorIsSatisfied:t=>t.every(C),partialEmit:!0};function z(t,e){if(t.every(t=>"IMPOSSIBLE"===t.type))return{type:"IMPOSSIBLE",blockers:[{type:"IMPOSSIBLE_SELECTOR",selector:e.selector,blockers:P(t)}]};const n=t.filter(C),r=n.length>0,s=r&&n.length===t.length,a=t.length-n.length;if(e.selectorIsSatisfied(t)){const{picked:t,meta:r}=Y(n,e.selector);return{type:"PICKED",picked:t,meta:r}}if(e.partialEmit&&!s&&r){const{picked:r}=Y(n,e.selector);return{type:"PICKED",picked:r,meta:{type:"UNRESOLVED",blockers:a>1?[{type:"UNRESOLVED_SELECTOR",selector:e.selector,blockers:$(t)}]:[...$(t)]}}}return{type:"UNRESOLVED",blockers:[{type:"UNRESOLVED_SELECTOR",selector:e.selector,blockers:$(t)}]}}function H(t,e){let n;switch(t.type){case"SINGLETON":const r=K(t.vesting_start,e);return"PICKED"===r.type?{type:r.type,picked:t,meta:r.meta}:r;case"EARLIER_OF":return n=t.items.map(t=>H(t,e)),z(n,B);case"LATER_OF":return n=t.items.map(t=>H(t,e)),z(n,G)}}function K(t,e){let n;switch(t.type){case"SINGLETON":const r=function(t,e){const n=I(t,e);if(!t.constraints)return n;const r=F(t,n,t.constraints,e);return r&&0!==r.length?(s=r)&&"object"==typeof s&&s.every(t=>"IMPOSSIBLE"===t.type.split("_")[0])?{type:"IMPOSSIBLE",blockers:r}:{type:"UNRESOLVED",blockers:r}:n;var s}(t,e);return"RESOLVED"===r.type?{type:"PICKED",picked:t,meta:r}:r;case"EARLIER_OF":return n=t.items.map(t=>K(t,e)),z(n,B);case"LATER_OF":return n=t.items.map(t=>K(t,e)),z(n,G)}}function Q(t){switch(t.type){case"EVENT_NOT_YET_OCCURRED":return`EVENT ${t.event}`;case"DATE_NOT_YET_OCCURRED":return`DATE ${t.date}`;case"UNRESOLVED_CONDITION":case"IMPOSSIBLE_CONDITION":return e=t.condition,`${J({...e,type:"SINGLETON"})}`;case"UNRESOLVED_SELECTOR":case"IMPOSSIBLE_SELECTOR":switch(t.selector){case"EARLIER_OF":return`EARLIER OF ( ${t.blockers.map(Q).join(", ")} )`;case"LATER_OF":return`LATER OF ( ${t.blockers.map(Q).join(", ")} )`}}var e}function J(t){return`${n=t.base,`${n.type} ${n.value}`}${e=t.offsets,0===e.length?"":` ${e.map(Z).join(" ")}`}${t.constraints?` ${W(t.constraints)}`:""}`;var e,n}function W(t){switch(t.type){case"ATOM":return function(t){const e=t.strict?"STRICTLY ":"";return`${e}${t.type} ${J(t.base)}`}(t.constraint);case"AND":case"OR":const e=t.items.map(W);return`${t.type} ( ${e} )`}}function Z(t){return`${"MINUS"===t.sign?"-":"+"}${t.value} ${t.unit.toLowerCase()}`}function q(t,e){return{amount:e,date:t,meta:{state:"RESOLVED"}}}function X(t,e){const n=Array.from({length:t.length},(n,r)=>function(t,e){return{amount:t,meta:{state:"IMPOSSIBLE",unresolved:e.map(Q).join(", ")}}}(t[r],e));return{installments:n,blockers:e}}function tt(t,e,n,r){const s=Array.from({length:t.length},(s,a)=>function(t,e,n,r,s){return{amount:e,meta:{state:"UNRESOLVED",symbolicDate:{type:"START_PLUS",unit:n,steps:t*r},unresolved:s.map(Q).join(", ")}}}(a,t[a],e,n,r));return{installments:s,blockers:r}}function et(t,e){const n=Array.from({length:t.length},(n,r)=>function(t,e){return{amount:t,meta:{state:"UNRESOLVED",symbolicDate:{type:"UNRESOLVED_VESTING_START"},unresolved:e.map(Q).join(", ")}}}(t[r],e));return{installments:n,blockers:e}}function nt(t,e,n){return{amount:e,meta:{state:"UNRESOLVED",symbolicDate:{type:"UNRESOLVED_CLIFF",date:t},unresolved:n.map(Q).join(", ")}}}function rt(t,e,n,r){const s={...r,events:{...r.events,vestingStart:t.meta.date}},a=t.picked.periodicity,o=K(a.cliff,s);if("IMPOSSIBLE"===o.type)return X(n,o.blockers);if("UNRESOLVED"===o.type)return function(t,e,n){return{installments:Array.from({length:e.length},(r,s)=>nt(t[s],e[s],n)),blockers:n}}(e,n,o.blockers);if(C(o))return function(t,e,n){const r=st(t,e,n,({date:t,amount:e})=>q(t,e));return{installments:r,blockers:[]}}(e,n,o.meta.date);const i=o.meta.blockers;if("LATER_OF"===a.cliff.type){const t=function(t,e){const n=[];for(const s of t.items){const t=K(s,e);"PICKED"===t.type&&"RESOLVED"===t.meta.type&&n.push(t.meta.date)}if(0===n.length)return;let r=n[0];for(let s=1;s<n.length;s++)R(r,n[s])&&(r=n[s]);return r}(a.cliff,s);if(t)return function(t,e,n,r){const s=st(t,e,n,({date:t,amount:e})=>nt(t,e,r));return{installments:s,blockers:r}}(e,n,t,i)}return tt(n,a.type,a.length,i)}function st(t,e,n,r){const s=[];let a=0,o=!1;for(let i=0;i<t.length;i++){const c=t[i],l=e[i],u=R(c,n),f=T(c,n);u?(a+=l,i===t.length-1&&s.push(r({date:n,amount:a}))):f?(a+=l,s.push(r({date:c,amount:a})),o=!0):(!o&&R(n,c)&&a>0&&(s.push(r({date:n,amount:a})),o=!0),s.push(r({date:c,amount:l})))}return s}function at(t,e){const{ctx:n,statementQuantity:r}=function(t,e){const n=(r=e,{...r,vesting_day_of_month:r.vesting_day_of_month??"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH",allocation_type:r.allocation_type??"CUMULATIVE_ROUND_DOWN"});var r;const s=(a=t.amount,o=n.grantQuantity,"QUANTITY"===a.type?a.value:o*(a.numerator/a.denominator));var a,o;if(s%1!=0||s<0)throw new Error(`expandAllocatedSchedule: totalQuantity must be a positive whole number or zero: ${s}`);return{ctx:n,statementQuantity:s}}(t,e),s=H(t.expr,n);switch(s.type){case"IMPOSSIBLE":return X([r],s.blockers);case"UNRESOLVED":return et([r],s.blockers);case"PICKED":return function(t,e,n){const r=t.picked,s=r.periodicity,{type:a,length:o,occurrences:i}=s;if(i<1)throw new Error(`Expected ${JSON.stringify(t.picked)} to have at least one installment.`);let c=function(t,e,n){if(e<=0)return[];switch(n){case"CUMULATIVE_ROUNDING":{const n=new Array(e).fill(0);for(let r=0;r<e;r++){const s=0===r?0:n.slice(0,r).reduce((t,e)=>t+e,0),a=Math.round((r+1)/e*t);n[r]=a-s}return n}case"CUMULATIVE_ROUND_DOWN":{const n=new Array(e).fill(0);for(let r=0;r<e;r++){const s=0===r?0:n.slice(0,r).reduce((t,e)=>t+e,0),a=Math.floor((r+1)/e*t);n[r]=a-s}return n}case"FRONT_LOADED":{const n=Math.floor(t/e),r=t%e;return Array.from({length:e},(t,e)=>e<r?n+1:n)}case"BACK_LOADED":{const n=Math.floor(t/e),r=t%e;return Array.from({length:e},(t,s)=>s>=e-r?n+1:n)}case"FRONT_LOADED_TO_SINGLE_TRANCHE":{const n=Math.floor(t/e);return[n+t%e,...Array.from({length:e-1},()=>n)]}case"BACK_LOADED_TO_SINGLE_TRANCHE":{const n=Math.floor(t/e),r=t%e;return[...Array.from({length:e-1},()=>n),n+r]}default:return Array.from({length:e},()=>Math.floor(t/e))}}(e,i,n.allocation_type);if("UNRESOLVED"===t.meta.type)return tt(c,a,o,t.meta.blockers);let l=t.meta.date,u=[];for(let p=0;p<i;p++)l=D(l,a,o,n),u.push(l);const{newDates:f,newAmounts:d}=function(t,e,n){const r=st(t,e,n,({date:t,amount:e})=>({date:t,amount:e}));let s=[],a=[];for(const o of r)s.push(o.date),a.push(o.amount);return{newDates:s,newAmounts:a}}(u,c,n.events.grantDate);return u=f,c=d,s.cliff?rt(t,u,c,n):function(t,e){const n=[];return t.forEach((t,r)=>n.push(q(t,e[r]))),{installments:n,blockers:[]}}(u,c)}(s,r,n)}}var ot=n(7213),it=n(851);function ct({className:t,...e}){return(0,s.jsx)(ot.b,{"date-slot":"label",className:(0,it.A)("flex items-center gap-2 text-sm leading-none font-medium select-none","peer-disabled:cursor-not-allowed peer-disabled:opacity-50","group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50",t),...e})}function lt({className:t,type:e,...n}){return(0,s.jsx)("input",{type:e,"data-slot":"input",className:(0,it.A)("h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base md:text-sm shadow-xs outline-none transition-[color,box-shadow]","border-input placeholder:text-muted-foreground","file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground","disabled:cursor-not-allowed disabled:opacity-50 disabled:pointer-events-none","focus-visible:ring-[3px] focus-visible:ring-ring/50 focus-visible:border-ring","aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40","dark:bg-input/30",t),...n})}function ut({events:t,setEvents:e}){return(0,s.jsx)("div",{className:"space-y-3",children:Object.keys(t).length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ct,{className:"text-sm font-medium",children:"Events"}),(0,s.jsx)("div",{className:"overlow-x-auto",children:(0,s.jsxs)("table",{className:"w-auto min-w-max border-collapse text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-[color:var(--ifm-toc-border-color)]",children:[(0,s.jsx)("th",{className:"text-left font-semibold py-2 pr-3",children:"Name"}),(0,s.jsx)("th",{className:"text-left font-semibold py-2",children:"Date"})]})}),(0,s.jsx)("tbody",{children:Object.entries(t).map(([t,n],r)=>(0,s.jsxs)("tr",{className:"border-b border-[color:var(--ifm-toc-border-color)] hover:bg-black/5 dark:hover:bg-white/5",children:[(0,s.jsx)("td",{className:"py-2 pr-3 whitespace-nowrap",children:t}),(0,s.jsx)("td",{className:"py-2 pr-3",children:(0,s.jsx)(lt,{type:"date",value:n,onChange:n=>((t,n)=>{e(e=>({...e,[t]:n}))})(t,n.target.value),className:"min-w-[10rem]"})})]},`${t}-${r}`))})]})})]}):null})}function ft({installments:t}){return(0,s.jsx)("div",{className:"overflow-auto max-h-[60vh] rounded-md",children:(0,s.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-[color:var(--card-border)]",children:[(0,s.jsx)("th",{className:"text-left font-semibold py-2 pr-3",children:"Amount"}),(0,s.jsx)("th",{className:"text-left font-semibold py-2",children:"Date"})]})}),(0,s.jsx)("tbody",{children:t.map((t,e)=>(0,s.jsxs)("tr",{className:"border-b border-[color:var(--card-border)] hover:bg-black/5 dark:hover:bg-white/5",children:[(0,s.jsx)("td",{className:"py-2 pr-3",children:t.amount}),(0,s.jsx)("td",{className:"py-2 pr-3",children:"RESOLVED"===t.meta.state?t.date:JSON.stringify(t.meta.symbolicDate)})]},e))})]})})}var dt=n(7606);function pt({className:t,...e}){return(0,s.jsx)(dt.bL,{className:(0,it.A)("w-full",t),...e})}function mt({className:t,...e}){return(0,s.jsx)(dt.B8,{className:(0,it.A)("flex w-full flex-wrap gap-2 border-b","border-[var(--card-border)]",t),...e})}function ht({className:t,...e}){return(0,s.jsx)(dt.l9,{className:(0,it.A)("relative -mb-px inline-flex items-center gap-2 rounded-t-md px-3 py-2 text-sm","text-muted-foreground hover:text-foreground","data-[state=active]:text-foreground","outline-none focus-visible:ring-[3px] focus-visible:ring-ring/50","after:absolute after:inset-x-0 after:-bottom-[1px] after:h-[2px] after:rounded-full after:bg-transparent","data-[state=active]:after:bg-primary",t),...e})}function Et({className:t,...e}){return(0,s.jsx)(dt.UC,{"data-slot":"tabs-content",className:(0,it.A)("py-4 focus:outline-none",t),...e})}function gt({schedules:t,ast:e}){return(0,s.jsxs)(pt,{defaultValue:"Installments",children:[(0,s.jsxs)(mt,{children:[(0,s.jsx)(ht,{value:"Installments",children:"Installments"}),(0,s.jsx)(ht,{value:"AST",children:"AST"})]}),(0,s.jsx)(Et,{value:"Installments",className:"mt-4",children:t.map((t,e)=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ft,{installments:t.installments},e),t.blockers.length>0?JSON.stringify(t.blockers):null]}))}),(0,s.jsx)(Et,{value:"AST",children:(0,s.jsx)("pre",{className:"text-xs leading-relaxed overflow-auto max-h-[60vh] rounded-md p-3 bg-[color:var(--ifm-pre-background)]",children:JSON.stringify(e,null,2)})})]})}function yt({className:t,...e}){return(0,s.jsx)("div",{"data-slot":"card",className:(0,it.$)("flex flex-col gap-6 rounded-xl border py-6 shadow-sm","bg-card text-card-foreground",t),...e})}function bt({className:t,...e}){return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,it.$)("grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6","has-[&>[data-slot=card-action]]:grid-cols-[1fr_auto]","[.border-b]:pb-6",t),...e})}function vt({className:t,...e}){return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,it.$)("leading-none font-semibold",t),...e})}function xt({className:t,...e}){return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,it.$)("text-muted-foreground text-sm",t),...e})}function Nt({className:t,...e}){return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,it.$)("px-6",t),...e})}function Ot({className:t,...e}){return(0,s.jsx)("textarea",{"data-slot":"textarea",className:(0,it.$)("min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base md:text-sm shadow-xs outline-none transition-[color,box-shadow]","border-input placeholder:text-muted-foreground","disabled:cursor-not-allowed disabled:opacity-50","focus-visible:ring-[3px] focus-visible:ring-ring/50 focus-visible:border-ring","aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40","dark:bg-input/30",t),...e})}function St(t){return new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().slice(0,10)}function At(){const[t,e]=(0,o.useState)(100),[n,r]=(0,o.useState)(new Date),[a,c]=(0,o.useState)({}),[u,f]=(0,o.useState)(""),[d,p]=(0,o.useState)(null),[h,E]=(0,o.useState)(null),[g,y]=(0,o.useState)(null),b=(0,o.useMemo)(()=>St(new Date),[]),v=(0,o.useCallback)(()=>{try{const e=l(u),r=e.map(m);p(r);const s=Array.from(new Set((t=>{const e=[],n=t=>{if(Array.isArray(t))for(const e of t)n(e);else if(t&&"object"==typeof t){const r=t;"EVENT"===r.type&&"string"==typeof r.value&&e.push(r.value);for(const t of Object.values(r))n(t)}};return n(t),e})(r))),o={};for(const t of s)"grantDate"!==t&&(o[t]=a[t]??b);c(o);const i={events:{grantDate:St(n),...o},grantQuantity:t,asOf:b,vesting_day_of_month:"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH",allocation_type:"CUMULATIVE_ROUND_DOWN"},f=r.map(t=>at(t,i));E(f),y(null)}catch(e){p(null),E(null),y(e?.message??String(e))}},[u,t,n,a,b]);return(0,o.useEffect)(()=>{const t=window.setTimeout(v,250);return()=>window.clearTimeout(t)},[v,u,t,n,a]),(0,s.jsx)(i.A,{children:()=>(0,s.jsx)("div",{className:"min-h-screen flex justify-center bg-gradient-to-br from-background to-muted/20 p-4",children:(0,s.jsxs)(yt,{className:"w-full max-w-2xl shadow-xl",children:[(0,s.jsxs)(bt,{className:"border-b bg-card",children:[(0,s.jsx)(vt,{className:"text-2xl font-semibold",children:"Vestlang Playground"}),(0,s.jsx)(xt,{children:"Enter grant details and DSL statement"})]}),(0,s.jsxs)(Nt,{className:"pt-6",children:[(0,s.jsx)("div",{className:"space-y-6 mb-8",children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 max-w-lg mx-auto",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(ct,{htmlFor:"quantity",className:"text-sm font-medium",children:"Quantity"}),(0,s.jsx)(lt,{id:"quantity",type:"number",min:0,value:Number.isFinite(t)?t:100,onChange:t=>e(Number(t.target.value)||100),className:"w-full"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(ct,{htmlFor:"grantDate",className:"text-sm font-medium",children:"Grant Date"}),(0,s.jsx)(lt,{id:"grantDate",type:"date",value:St(n),onChange:t=>r(new Date(t.target.value)),className:"w-full"})]}),(0,s.jsx)(ut,{events:a,setEvents:c}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(ct,{htmlFor:"dsl",className:"text-sm font-medium",children:"DSL Input"}),(0,s.jsx)(Ot,{id:"dsl",value:u,onChange:t=>f(t.target.value),rows:3,className:"w-full"})]}),g&&""!==u&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Error:"}),g]})]})}),h&&d&&(0,s.jsx)(gt,{schedules:h,ast:d})]})]})})})}const wt={title:"Playground",sidebar_position:5},Lt=void 0,Rt={},_t=[];function Tt(t){return(0,s.jsx)(At,{})}function Dt(t={}){const{wrapper:e}={...(0,a.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(Tt,{...t})}):Tt()}}}]);