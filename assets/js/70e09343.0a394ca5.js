"use strict";(self.webpackChunk_vestlang_docs=self.webpackChunk_vestlang_docs||[]).push([[462],{4692:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>St,contentTitle:()=>bt,default:()=>xt,frontMatter:()=>vt,metadata:()=>n,toc:()=>Ot});const n=JSON.parse('{"id":"playground","title":"Playground","description":"","source":"@site/docs/playground.mdx","sourceDirName":".","slug":"/playground","permalink":"/vestlang/playground","draft":false,"unlisted":false,"editUrl":"https://github.com/MattCantor/vestlang/docs/playground.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Playground","hide_title":true,"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Command Line Interface","permalink":"/vestlang/cli"}}');var s=r(5270),o=r(7678),a=r(9430),i=r(9807);class c extends SyntaxError{constructor(t,e,r,n){super(t),this.expected=e,this.found=r,this.location=n,this.name="SyntaxError"}format(t){let e="Error: "+this.message;if(this.location){let r=null;const n=t.find(t=>t.source===this.location.source);n&&(r=n.text.split(/\r\n|\n|\r/g));const s=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,a=this.location.source+":"+o.line+":"+o.column;if(r){const t=this.location.end,n="".padEnd(o.line.toString().length," "),i=r[s.line-1],c=(s.line===t.line?t.column:i.length+1)-s.column||1;e+="\n --\x3e "+a+"\n"+n+" |\n"+o.line+" | "+i+"\n"+n+" | "+"".padEnd(s.column-1," ")+"".padEnd(c,"^")}else e+="\n at "+a}return e}static buildMessage(t,e){function r(t){return t.codePointAt(0).toString(16).toUpperCase()}const n=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function s(t){return n?t.replace(n,t=>"\\u{"+r(t)+"}"):t}function o(t){return s(t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t)))}function a(t){return s(t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t)))}const i={literal:t=>'"'+o(t.text)+'"',class(t){const e=t.parts.map(t=>Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t));return"["+(t.inverted?"^":"")+e.join("")+"]"+(t.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:t=>t.description};function c(t){return i[t.type](t)}return"Expected "+function(t){const e=t.map(c);if(e.sort(),e.length>0){let t=1;for(let r=1;r<e.length;r++)e[r-1]!==e[r]&&(e[t]=e[r],t++);e.length=t}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."}}function l(t,e){const r={},n=(e=void 0!==e?e:{}).grammarSource,s={Start:qt};let o=qt;const a="vest",i="[",l="]",u="and",f="or",d=",",m=".",p="/",h="day",y="s",g="month",E="week",v="year",b="strictly",S="date",O="-",A="grantdate",x="grant_date",R="grant-date",N="vestingstart",L="vesting_start",_="vesting-start",D="event",w="before",T="after",C="(",I=")",j="earlier",k="later",V="of",M="over",F="every",U="from",$="cliff",P=/^[ \t\r\n]/,Y=/^[+\-]/,B=/^[0-9]/,z=/^[0-1]/,G=/^[A-Za-z_]/,H=/^[A-Za-z0-9_]/,W=/^[0-3]/,K=zt("VEST",!0),Q=zt("[",!1),q=zt("]",!1),J={type:"any"},Z=Gt([" ","\t","\r","\n"],!1,!1,!1),X=zt("AND",!0),tt=zt("OR",!0),et=zt(",",!1),rt=Gt(["+","-"],!1,!1,!1),nt=Gt([["0","9"]],!1,!1,!1),st=zt(".",!1),ot=Gt([["0","1"]],!1,!1,!1),at=zt("/",!1),it=zt("day",!0),ct=zt("s",!1),lt=zt("month",!0),ut=zt("week",!0),ft=zt("year",!0),dt=Gt([["A","Z"],["a","z"],"_"],!1,!1,!1),mt=Gt([["A","Z"],["a","z"],["0","9"],"_"],!1,!1,!1),pt=zt("STRICTLY",!0),ht=zt("DATE",!0),yt=zt("-",!1),gt=Gt([["0","3"]],!1,!1,!1),Et=zt("grantdate",!0),vt=zt("grant_date",!0),bt=zt("grant-date",!0),St=zt("vestingstart",!0),Ot=zt("vesting_start",!0),At=zt("vesting-start",!0),xt=zt("EVENT",!0),Rt=zt("BEFORE",!0),Nt=zt("AFTER",!0),Lt=zt("(",!1),_t=zt(")",!1),Dt=zt("EARLIER",!0),wt=zt("LATER",!0),Tt=zt("OF",!0),Ct=zt("OVER",!0),It=zt("EVERY",!0),jt=zt("FROM",!0),kt=zt("CLIFF",!0);let Vt=0|e.peg$currPos,Mt=Vt;const Ft=[{line:1,column:1}];let Ut,$t=Vt,Pt=e.peg$maxFailExpected||[],Yt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');o=s[e.startRule]}function Bt(t,e){throw function(t,e){return new c(t,null,null,e)}(t,e=void 0!==e?e:Wt(Mt,Vt))}function zt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Gt(t,e,r,n){return{type:"class",parts:t,inverted:e,ignoreCase:r,unicode:n}}function Ht(e){let r,n=Ft[e];if(n)return n;if(e>=Ft.length)r=Ft.length-1;else for(r=e;!Ft[--r];);for(n=Ft[r],n={line:n.line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ft[e]=n,n}function Wt(t,e,r){const s=Ht(t),o=Ht(e),a={source:n,start:{offset:t,line:s.line,column:s.column},end:{offset:e,line:o.line,column:o.column}};return r&&n&&"function"==typeof n.offset&&(a.start=n.offset(a.start),a.end=n.offset(a.end)),a}function Kt(t){Vt<$t||(Vt>$t&&($t=Vt,Pt=[]),Pt.push(t))}function Qt(t,e,r){return new c(c.buildMessage(t,e),t,e,r)}function qt(){let e,n,s,o,a;return e=Vt,n=Zt(),s=Vt,o=function(){let e,n,s,o,a,c,u,f,d;e=Vt,91===t.charCodeAt(Vt)?(n=i,Vt++):(n=r,0===Yt&&Kt(Q));if(n!==r)if(s=Zt(),o=Jt(),o!==r){for(a=[],c=Vt,u=ee(),u!==r?(f=Jt(),f!==r?(u=[u,f],c=u):(Vt=c,c=r)):(Vt=c,c=r);c!==r;)a.push(c),c=Vt,u=ee(),u!==r?(f=Jt(),f!==r?(u=[u,f],c=u):(Vt=c,c=r)):(Vt=c,c=r);c=Zt(),u=ee(),u===r&&(u=null),f=Zt(),93===t.charCodeAt(Vt)?(d=l,Vt++):(d=r,0===Yt&&Kt(q)),d!==r?(Mt=e,e=Oe(o,a)):(Vt=e,e=r)}else Vt=e,e=r;else Vt=e,e=r;return e}(),o!==r&&(Mt=s),s=o,s===r&&(s=Vt,o=Jt(),o!==r&&(Mt=s,o=[o]),s=o),s!==r?(o=Zt(),a=function(){let e,n;e=Vt,Yt++,t.length>Vt?(n=t.charAt(Vt),Vt++):(n=r,0===Yt&&Kt(J));Yt--,n===r?e=void 0:(Vt=e,e=r);return e}(),a!==r?(Mt=e,e=s):(Vt=e,e=r)):(Vt=e,e=r),e}function Jt(){let e,n,s,o,i,c,l,u;var f;return e=Vt,n=Zt(),s=function(){let e,n,s,o;e=Vt,n=Zt(),s=function(){let e,n;e=Vt,n=function(){let e,n,s,o,a,i,c;e=Vt,n=Vt,s=Vt,46===t.charCodeAt(Vt)?(o=m,Vt++):(o=r,0===Yt&&Kt(st));if(o!==r){if(a=[],i=t.charAt(Vt),B.test(i)?Vt++:(i=r,0===Yt&&Kt(nt)),i!==r)for(;i!==r;)a.push(i),i=t.charAt(Vt),B.test(i)?Vt++:(i=r,0===Yt&&Kt(nt));else a=r;a!==r?(o=[o,a],s=o):(Vt=s,s=r)}else Vt=s,s=r;if(s===r)if(s=Vt,o=t.charAt(Vt),z.test(o)?Vt++:(o=r,0===Yt&&Kt(ot)),o!==r)if(46===t.charCodeAt(Vt)?(a=m,Vt++):(a=r,0===Yt&&Kt(st)),a!==r){if(i=[],c=t.charAt(Vt),B.test(c)?Vt++:(c=r,0===Yt&&Kt(nt)),c!==r)for(;c!==r;)i.push(c),c=t.charAt(Vt),B.test(c)?Vt++:(c=r,0===Yt&&Kt(nt));else i=r;i!==r?(o=[o,a,i],s=o):(Vt=s,s=r)}else Vt=s,s=r;else Vt=s,s=r;n=s!==r?t.substring(n,Vt):s;n!==r&&(Mt=e);return e=n,e}(),n!==r&&(Mt=e,n=function(t){const e=parseFloat(t);(e<0||e>1)&&Bt("Decimal portion must be between 0 and 1 inclusive");const r=((t.startsWith(".")?["0",t.slice(1)]:t.split("."))[1]??"").length,n=Math.pow(10,r);return be(Math.round(e*n),n)}(n));return e=n,e}(),s===r&&(s=function(){let e,n,s,o,a,i;e=Vt,n=re(),n!==r?(s=Zt(),47===t.charCodeAt(Vt)?(o=p,Vt++):(o=r,0===Yt&&Kt(at)),o!==r?(a=Zt(),i=re(),i!==r?(Mt=e,e=be(n,i)):(Vt=e,e=r)):(Vt=e,e=r)):(Vt=e,e=r);return e}(),s===r&&(s=function(){let t,e;t=Vt,e=re(),e!==r&&(Mt=t,e={type:"QUANTITY",value:e});return t=e,t}()));s!==r?(o=Zt(),Mt=e,e=s):(Vt=e,e=r);return e}(),s===r&&(s=null),o=Zt(),i=t.substr(Vt,4),i.toLowerCase()===a?Vt+=4:(i=r,0===Yt&&Kt(K)),i!==r?(c=Zt(),l=ge(),l!==r?(u=Zt(),Mt=e,f=l,e={amount:s??be(1,1),expr:f}):(Vt=e,e=r)):(Vt=e,e=r),e}function Zt(){let e,n;for(e=[],n=t.charAt(Vt),P.test(n)?Vt++:(n=r,0===Yt&&Kt(Z));n!==r;)e.push(n),n=t.charAt(Vt),P.test(n)?Vt++:(n=r,0===Yt&&Kt(Z));return e}function Xt(){let e,n,s,o;return e=Vt,n=Zt(),s=t.substr(Vt,3),s.toLowerCase()===u?Vt+=3:(s=r,0===Yt&&Kt(X)),s!==r?(o=Zt(),Mt=e,e="AND"):(Vt=e,e=r),e}function te(){let e,n,s,o;return e=Vt,n=Zt(),s=t.substr(Vt,2),s.toLowerCase()===f?Vt+=2:(s=r,0===Yt&&Kt(tt)),s!==r?(o=Zt(),Mt=e,e="OR"):(Vt=e,e=r),e}function ee(){let e,n,s,o;return e=Vt,n=Zt(),44===t.charCodeAt(Vt)?(s=d,Vt++):(s=r,0===Yt&&Kt(et)),s!==r?(o=Zt(),n=[n,s,o],e=n):(Vt=e,e=r),e}function re(){let e,n,s,o;if(e=Vt,n=Vt,s=[],o=t.charAt(Vt),B.test(o)?Vt++:(o=r,0===Yt&&Kt(nt)),o!==r)for(;o!==r;)s.push(o),o=t.charAt(Vt),B.test(o)?Vt++:(o=r,0===Yt&&Kt(nt));else s=r;return n=s!==r?t.substring(n,Vt):s,n!==r?(s=Vt,Yt++,46===t.charCodeAt(Vt)?(o=m,Vt++):(o=r,0===Yt&&Kt(st)),Yt--,o===r?s=void 0:(Vt=s,s=r),s!==r?(Mt=e,e=parseInt(n,10)):(Vt=e,e=r)):(Vt=e,e=r),e}function ne(){let e,n,s,o,a,i;return e=Vt,n=function(){let e;return e=t.charAt(Vt),Y.test(e)?Vt++:(e=r,0===Yt&&Kt(rt)),e}(),n===r&&(n=null),s=Zt(),o=re(),o!==r?(a=Zt(),i=function(){let e,n,s;e=Vt,n=t.substr(Vt,3),n.toLowerCase()===h?Vt+=3:(n=r,0===Yt&&Kt(it));n!==r?(115===t.charCodeAt(Vt)?(s=y,Vt++):(s=r,0===Yt&&Kt(ct)),s===r&&(s=null),Mt=e,e="DAYS"):(Vt=e,e=r);e===r&&(e=Vt,n=t.substr(Vt,5),n.toLowerCase()===g?Vt+=5:(n=r,0===Yt&&Kt(lt)),n!==r?(115===t.charCodeAt(Vt)?(s=y,Vt++):(s=r,0===Yt&&Kt(ct)),s===r&&(s=null),Mt=e,e="MONTHS"):(Vt=e,e=r),e===r&&(e=Vt,n=t.substr(Vt,4),n.toLowerCase()===E?Vt+=4:(n=r,0===Yt&&Kt(ut)),n!==r?(115===t.charCodeAt(Vt)?(s=y,Vt++):(s=r,0===Yt&&Kt(ct)),s===r&&(s=null),Mt=e,e="weeks"):(Vt=e,e=r),e===r&&(e=Vt,n=t.substr(Vt,4),n.toLowerCase()===v?Vt+=4:(n=r,0===Yt&&Kt(ft)),n!==r?(115===t.charCodeAt(Vt)?(s=y,Vt++):(s=r,0===Yt&&Kt(ct)),s===r&&(s=null),Mt=e,e="years"):(Vt=e,e=r))));return e}(),i!==r?(Mt=e,e=function(t,e,r){const n="-"===t?"MINUS":"PLUS";switch(r){case"weeks":return Ee(7*e,"DAYS",n);case"years":return Ee(12*e,"MONTHS",n);case"DAYS":case"MONTHS":return Ee(e,r,n);default:Bt("Unknown duration unit: "+r)}}(n,o,i)):(Vt=e,e=r)):(Vt=e,e=r),e}function se(){let e,n,s,o;return e=Vt,n=t.substr(Vt,5),n.toLowerCase()===D?Vt+=5:(n=r,0===Yt&&Kt(xt)),n!==r?(s=Zt(),o=function(){let e,n;return e=Vt,n=t.substr(Vt,9),n.toLowerCase()===A?Vt+=9:(n=r,0===Yt&&Kt(Et)),n!==r&&(Mt=e,n="grantDate"),e=n,e===r&&(e=Vt,n=t.substr(Vt,10),n.toLowerCase()===x?Vt+=10:(n=r,0===Yt&&Kt(vt)),n!==r&&(Mt=e,n="grantDate"),e=n,e===r&&(e=Vt,n=t.substr(Vt,10),n.toLowerCase()===R?Vt+=10:(n=r,0===Yt&&Kt(bt)),n!==r&&(Mt=e,n="grantDate"),e=n,e===r&&(e=Vt,n=t.substr(Vt,12),n.toLowerCase()===N?Vt+=12:(n=r,0===Yt&&Kt(St)),n!==r&&(Mt=e,n="vestingStart"),e=n,e===r&&(e=Vt,n=t.substr(Vt,13),n.toLowerCase()===L?Vt+=13:(n=r,0===Yt&&Kt(Ot)),n!==r&&(Mt=e,n="vestingStart"),e=n,e===r&&(e=Vt,n=t.substr(Vt,13),n.toLowerCase()===_?Vt+=13:(n=r,0===Yt&&Kt(At)),n!==r&&(Mt=e,n="vestingStart"),e=n))))),e}(),o===r&&(o=function(){let e,n,s,o,a;if(e=Vt,n=Vt,s=t.charAt(Vt),G.test(s)?Vt++:(s=r,0===Yt&&Kt(dt)),s!==r){for(o=[],a=t.charAt(Vt),H.test(a)?Vt++:(a=r,0===Yt&&Kt(mt));a!==r;)o.push(a),a=t.charAt(Vt),H.test(a)?Vt++:(a=r,0===Yt&&Kt(mt));s=[s,o],n=s}else Vt=n,n=r;return e=n!==r?t.substring(e,Vt):n,e}()),o!==r?(Mt=e,e=function(t){return{type:"EVENT",value:t}}(o)):(Vt=e,e=r)):(Vt=e,e=r),e}function oe(){let e,n,s,o,a,i;if(e=Vt,n=se(),n===r&&(n=function(){let e,n,s,o,a,i,c,l,u,f,d,m,p,h,y;return e=Vt,n=t.substr(Vt,4),n.toLowerCase()===S?Vt+=4:(n=r,0===Yt&&Kt(ht)),n!==r?(s=Zt(),o=Vt,a=Vt,i=t.charAt(Vt),B.test(i)?Vt++:(i=r,0===Yt&&Kt(nt)),i!==r?(c=t.charAt(Vt),B.test(c)?Vt++:(c=r,0===Yt&&Kt(nt)),c!==r?(l=t.charAt(Vt),B.test(l)?Vt++:(l=r,0===Yt&&Kt(nt)),l!==r?(u=t.charAt(Vt),B.test(u)?Vt++:(u=r,0===Yt&&Kt(nt)),u!==r?(45===t.charCodeAt(Vt)?(f=O,Vt++):(f=r,0===Yt&&Kt(yt)),f!==r?(d=t.charAt(Vt),z.test(d)?Vt++:(d=r,0===Yt&&Kt(ot)),d!==r?(m=t.charAt(Vt),B.test(m)?Vt++:(m=r,0===Yt&&Kt(nt)),m!==r?(45===t.charCodeAt(Vt)?(p=O,Vt++):(p=r,0===Yt&&Kt(yt)),p!==r?(h=t.charAt(Vt),W.test(h)?Vt++:(h=r,0===Yt&&Kt(gt)),h!==r?(y=t.charAt(Vt),B.test(y)?Vt++:(y=r,0===Yt&&Kt(nt)),y!==r?(i=[i,c,l,u,f,d,m,p,h,y],a=i):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r)):(Vt=a,a=r),o=a!==r?t.substring(o,Vt):a,o!==r?(Mt=e,g=o,e={type:"DATE",value:g}):(Vt=e,e=r)):(Vt=e,e=r),e;var g}()),n!==r){for(s=[],o=Vt,a=Zt(),i=ne(),i!==r?(a=[a,i],o=a):(Vt=o,o=r);o!==r;)s.push(o),o=Vt,a=Zt(),i=ne(),i!==r?(a=[a,i],o=a):(Vt=o,o=r);o=Vt,a=Zt(),i=ue(),i!==r?(a=[a,i],o=a):(Vt=o,o=r),o===r&&(o=null),Mt=e,e=function(t,e,r){const n={type:"SINGLETON",base:t,offsets:ve(e.map(t=>t[1]))};return r&&(n.constraints=r[1]),n}(n,s,o)}else Vt=e,e=r;return e}function ae(){let e,n,s,o,a,i;var c,l;return e=Vt,n=function(){let e,n;return e=Vt,n=t.substr(Vt,8),n.toLowerCase()===b?Vt+=8:(n=r,0===Yt&&Kt(pt)),n!==r&&(Mt=e,n=!0),e=n,e}(),n===r&&(n=null),s=Zt(),o=t.substr(Vt,6),o.toLowerCase()===w?Vt+=6:(o=r,0===Yt&&Kt(Rt)),o===r&&(o=t.substr(Vt,5),o.toLowerCase()===T?Vt+=5:(o=r,0===Yt&&Kt(Nt))),o!==r?(a=Zt(),i=oe(),i!==r?(Mt=e,c=n,l=i,e={type:"ATOM",constraint:{type:o.toUpperCase(),base:l,strict:!!c}}):(Vt=e,e=r)):(Vt=e,e=r),e}function ie(){let e,n,s,o,a,i,c,l,d;if(e=Vt,n=t.substr(Vt,3),n.toLowerCase()===u?Vt+=3:(n=r,0===Yt&&Kt(X)),n===r&&(n=t.substr(Vt,2),n.toLowerCase()===f?Vt+=2:(n=r,0===Yt&&Kt(tt))),n!==r)if(40===t.charCodeAt(Vt)?(s=C,Vt++):(s=r,0===Yt&&Kt(Lt)),s!==r)if(o=Zt(),a=ue(),a!==r){for(i=[],c=Vt,l=ee(),l!==r?(d=ue(),d!==r?(l=[l,d],c=l):(Vt=c,c=r)):(Vt=c,c=r);c!==r;)i.push(c),c=Vt,l=ee(),l!==r?(d=ue(),d!==r?(l=[l,d],c=l):(Vt=c,c=r)):(Vt=c,c=r);c=Zt(),41===t.charCodeAt(Vt)?(l=I,Vt++):(l=r,0===Yt&&Kt(_t)),l!==r?(Mt=e,m=a,p=i,e=Ae(n.toUpperCase(),Se(m,p))):(Vt=e,e=r)}else Vt=e,e=r;else Vt=e,e=r;else Vt=e,e=r;var m,p;return e}function ce(){let e;return e=function(){let e,n,s,o,a,i;return e=Vt,40===t.charCodeAt(Vt)?(n=C,Vt++):(n=r,0===Yt&&Kt(Lt)),n!==r?(s=Zt(),o=ue(),o!==r?(a=Zt(),41===t.charCodeAt(Vt)?(i=I,Vt++):(i=r,0===Yt&&Kt(_t)),i!==r?(Mt=e,e=o):(Vt=e,e=r)):(Vt=e,e=r)):(Vt=e,e=r),e}(),e===r&&(e=ie(),e===r&&(e=ae())),e}function le(){let t,e,n,s,o,a;if(t=Vt,e=ce(),e!==r){for(n=[],s=Vt,o=Xt(),o!==r?(a=ce(),a!==r?(o=[o,a],s=o):(Vt=s,s=r)):(Vt=s,s=r);s!==r;)n.push(s),s=Vt,o=Xt(),o!==r?(a=ce(),a!==r?(o=[o,a],s=o):(Vt=s,s=r)):(Vt=s,s=r);Mt=t,i=e,t=0===(c=n).length?i:Ae("AND",Se(i,c))}else Vt=t,t=r;var i,c;return t}function ue(){let t,e,n,s,o,a;if(t=Vt,e=le(),e!==r){for(n=[],s=Vt,o=te(),o!==r?(a=le(),a!==r?(o=[o,a],s=o):(Vt=s,s=r)):(Vt=s,s=r);s!==r;)n.push(s),s=Vt,o=te(),o!==r?(a=le(),a!==r?(o=[o,a],s=o):(Vt=s,s=r)):(Vt=s,s=r);Mt=t,i=e,t=0===(c=n).length?i:Ae("OR",Se(i,c))}else Vt=t,t=r;var i,c;return t}function fe(){let e;return e=function(){let e,n,s,o,a,i,c,l,u,f,d,m;e=Vt,n=t.substr(Vt,7),n.toLowerCase()===j?Vt+=7:(n=r,0===Yt&&Kt(Dt));n===r&&(n=t.substr(Vt,5),n.toLowerCase()===k?Vt+=5:(n=r,0===Yt&&Kt(wt)));if(n!==r)if(s=Zt(),o=t.substr(Vt,2),o.toLowerCase()===V?Vt+=2:(o=r,0===Yt&&Kt(Tt)),o!==r)if(a=Zt(),40===t.charCodeAt(Vt)?(i=C,Vt++):(i=r,0===Yt&&Kt(Lt)),i!==r)if(c=Zt(),l=fe(),l!==r){for(u=[],f=Vt,d=ee(),d!==r?(m=fe(),m!==r?(d=[d,m],f=d):(Vt=f,f=r)):(Vt=f,f=r);f!==r;)u.push(f),f=Vt,d=ee(),d!==r?(m=fe(),m!==r?(d=[d,m],f=d):(Vt=f,f=r)):(Vt=f,f=r);f=Zt(),41===t.charCodeAt(Vt)?(d=I,Vt++):(d=r,0===Yt&&Kt(_t)),d!==r?(Mt=e,p=l,h=u,e={type:"EARLIER"===n.toUpperCase()?"EARLIER_OF":"LATER_OF",items:Oe(p,h)}):(Vt=e,e=r)}else Vt=e,e=r;else Vt=e,e=r;else Vt=e,e=r;else Vt=e,e=r;var p,h;return e}(),e===r&&(e=oe(),e===r&&(e=ne())),e}function de(){let e,n,s,o;var a;return e=Vt,n=t.substr(Vt,4),n.toLowerCase()===M?Vt+=4:(n=r,0===Yt&&Kt(Ct)),n!==r?(s=Zt(),o=ne(),o!==r?(Mt=e,"MINUS"===(a=o).sign&&Bt("OVER may not include a negative duration"),e=a):(Vt=e,e=r)):(Vt=e,e=r),e}function me(){let e,n,s,o;var a;return e=Vt,n=t.substr(Vt,5),n.toLowerCase()===F?Vt+=5:(n=r,0===Yt&&Kt(It)),n!==r?(s=Zt(),o=ne(),o!==r?(Mt=e,"MINUS"===(a=o).sign&&Bt("EVERY may not include a negative duration"),e=a):(Vt=e,e=r)):(Vt=e,e=r),e}function pe(){let t,e,n,s;return t=Vt,e=de(),e!==r?(n=Zt(),s=me(),s!==r?(Mt=t,t=function(t,e){t.unit!==e.unit&&Bt("EVERY and OVER must have the same units");const r=t.value,n=e.value;return 0===r&&0!==n&&Bt("EVERY must be non-zero when OVER is non-zero"),0===n&&0!==r&&Bt("OVER must be non-zero when EVERY is non-zero"),0===r&&0===n?{type:"DAYS",length:0,occurrences:1}:(r%n!==0&&Bt("OVER must be a multiple of every"),{type:t.unit,length:n,occurrences:r/n})}(e,s)):(Vt=t,t=r)):(Vt=t,t=r),t===r&&(t=Vt,e=de(),e!==r&&(Mt=t,e=void Bt("EVERY must be provided when OVER is present")),t=e,t===r&&(t=Vt,e=me(),e!==r&&(Mt=t,e=void Bt("OVER must be provided when EVERY is present")),t=e,t===r&&(t=Vt,e="",Mt=t,e={type:"DAYS",length:0,occurrences:1},t=e))),t}function he(){let e,n,s,o;return e=Vt,n=t.substr(Vt,4),n.toLowerCase()===U?Vt+=4:(n=r,0===Yt&&Kt(jt)),n!==r?(s=Zt(),o=oe(),o===r&&(o=fe()),o!==r?(Mt=e,e=function(t){if("SINGLETON"===t.type&&"EVENT"===t.base.type&&"vestingStart"===t.base.value)throw new SyntaxError("vestingStart is a reserved system event that cannot be used in a `FROM` statement. Pick a different event name.");return t}(o)):(Vt=e,e=r)):(Vt=e,e=r),e}function ye(){let e,n,s,o;return e=Vt,n=t.substr(Vt,5),n.toLowerCase()===$?Vt+=5:(n=r,0===Yt&&Kt(kt)),n!==r?(s=Zt(),o=oe(),o===r&&(o=fe()),o!==r?(Mt=e,e=function(t){if("SINGLETONE"===t.type&&"EVENT"===t.base.type&&"grantDate"===t.base.value)throw new SyntaxError("grantDate is a reserved system event that cannot be used in a `CLIFF` statement. The `CLIFF` will refer to the computed `vestingStart` date, unless an alternative event is provided.");return t}(o)):(Vt=e,e=r)):(Vt=e,e=r),e}function ge(){let e;return e=function(){let e,n,s,o,a,i,c,l,u,f,d,m;e=Vt,n=t.substr(Vt,7),n.toLowerCase()===j?Vt+=7:(n=r,0===Yt&&Kt(Dt));n===r&&(n=t.substr(Vt,5),n.toLowerCase()===k?Vt+=5:(n=r,0===Yt&&Kt(wt)));if(n!==r)if(s=Zt(),o=t.substr(Vt,2),o.toLowerCase()===V?Vt+=2:(o=r,0===Yt&&Kt(Tt)),o!==r)if(a=Zt(),40===t.charCodeAt(Vt)?(i=C,Vt++):(i=r,0===Yt&&Kt(Lt)),i!==r)if(c=Zt(),l=ge(),l!==r){for(u=[],f=Vt,d=ee(),d!==r?(m=ge(),m!==r?(d=[d,m],f=d):(Vt=f,f=r)):(Vt=f,f=r);f!==r;)u.push(f),f=Vt,d=ee(),d!==r?(m=ge(),m!==r?(d=[d,m],f=d):(Vt=f,f=r)):(Vt=f,f=r);f=Zt(),41===t.charCodeAt(Vt)?(d=I,Vt++):(d=r,0===Yt&&Kt(_t)),d!==r?(Mt=e,p=l,h=u,e={type:"EARLIER"===n.toUpperCase()?"EARLIER_OF":"LATER_OF",items:Oe(p,h)}):(Vt=e,e=r)}else Vt=e,e=r;else Vt=e,e=r;else Vt=e,e=r;else Vt=e,e=r;var p,h;return e}(),e===r&&(e=function(){let t,e,n,s,o,a;return t=Vt,e=he(),e===r&&(e=null),n=Zt(),s=pe(),s!==r?(o=Zt(),a=ye(),a===r&&(a=null),Mt=t,t=function(t,e,r){const n={type:"SINGLETON",vesting_start:t,periodicity:e};return r&&(n.periodicity.cliff=r),n}(e,s,a)):(Vt=t,t=r),t}()),e}function Ee(t,e,r){return{type:"DURATION",value:t,unit:e,sign:r}}function ve(t){if(!t||0===t.length)return[];let e=0,r=0;for(const s of t){const t=Math.abs(s.value),n="MINUS"===s.sign?-t:t;if("MONTHS"===s.unit)e+=n;else{if("DAYS"!==s.unit)throw new SyntaxError(`Unknown offset type ${s.unit}`);r+=n}}const n=[];return 0!==e&&n.push(Ee(Math.abs(e),"MONTHS",e<0?"MINUS":"PLUS")),0!==r&&n.push(Ee(Math.abs(r),"DAYS",r<0?"MINUS":"PLUS")),n}function be(t,e){if(0===e)throw new SyntaxError("Denominator cannot be 0");e<0&&(t=-t,e=-e);const r=function(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){const r=t%e;t=e,e=r}return t||1}(Math.abs(t),e);return{type:"PORTION",numerator:t/r,denominator:e/r}}function Se(t,e){return[t,...e.map(t=>t[1])]}function Oe(t,e){const r=Se(t,e);if(r.length<2)throw new SyntaxError("At least two items are required");return r}function Ae(t,e){const r=t.toUpperCase(),n=[];for(const s of e)s&&s.type===r&&Array.isArray(s.items)?n.push(...s.items):n.push(s);if(1===n.length)return n[0];if(n.length<2)throw new SyntaxError(`${r} requires at least two items`);return{type:r,items:n}}Ut=o();const xe=Ut!==r&&Vt===t.length;function Re(){throw Ut!==r&&Vt<t.length&&Kt({type:"end"}),Qt(Pt,$t<t.length?function(e=Vt){const r=t.codePointAt(e);return void 0===r?"":String.fromCodePoint(r)}($t):null,$t<t.length?Wt($t,$t+1):Wt($t,$t))}return e.peg$library?{peg$result:Ut,peg$currPos:Vt,peg$FAILED:r,peg$maxFailExpected:Pt,peg$maxFailPos:$t,peg$success:xe,peg$throw:xe?void 0:Re}:xe?Ut:void Re()}function u(t){const e=new WeakSet,r=t=>{if(null===t||"object"!=typeof t)return t;if(e.has(t))return"[Circular]";if(e.add(t),Array.isArray(t))return t.map(r);const n=Object.keys(t).sort(),s={};for(const e of n)s[e]=r(t[e]);return s};return JSON.stringify(r(t))}function f(t,e){let r=t.items.map(e);if(r=r.flatMap(e=>e.type===t.type?e.items:[e]),r.sort((t,e)=>u(t).localeCompare(u(e))),r=function(t){const e=new Set,r=[];for(const n of t){const t=u(n);e.has(t)||(e.add(t),r.push(n))}return r}(r),1===r.length)return r[0];if(0===r.length)throw new Error(`${t.type} became empty after normalization`);return{...t,items:r}}function d(t){return t.constraints?{...t,constraints:m(t.constraints)}:t}function m(t){switch(t.type){case"ATOM":return function(t){const e=d(t.constraint.base);return{type:"ATOM",constraint:{...t.constraint,base:e}}}(t);case"AND":case"OR":return f(t,m);default:throw new Error(`normalizeCondition: unexpected condition type ${t?.type}`)}}function p(t){return{amount:t.amount,expr:h(t.expr)}}function h(t){switch(t.type){case"SINGLETON":return function(t){const e=g(t.vesting_start??{type:"SINGLETON",base:{type:"EVENT",value:"grantDate"},offsets:[]}),r=t.periodicity.cliff?{...t.periodicity,cliff:E(t.periodicity.cliff)}:{...t.periodicity};return{...t,vesting_start:e,periodicity:r}}(t);case"EARLIER_OF":case"LATER_OF":return f(t,h);default:throw new Error(`normalizeScheduleExpr: unexpected ScheduleExpr type ${t?.type}`)}}function y(t,e){switch(t.type){case"DURATION":return{type:"SINGLETON",base:{type:"EVENT",value:e},offsets:[t]};case"LATER_OF":case"EARLIER_OF":return f(t,"grantDate"===e?g:E);case"SINGLETON":return v(t);default:throw new Error(`normalizeCliff: unexpected cliff type ${t?.type}`)}}function g(t){return y(t,"grantDate")}function E(t){return y(t,"vestingStart")}function v(t){switch(t.type){case"SINGLETON":return d(t);case"EARLIER_OF":case"LATER_OF":return f(t,v);default:throw new Error(`normalizeVestingNodeExpr: unexpected VestingNode type ${t?.type}`)}}var b=r(7824),S=r(6053),O=r(8398),A=r(9944);const x=t=>new Date(t+"T00:00:00Z"),R=t=>t.toISOString().slice(0,10);function N(t,e,r){const n=x(t),s=n.getUTCFullYear(),o=n.getUTCMonth()+e,a=s+Math.floor(o/12),i=(o%12+12)%12,c=new Date(Date.UTC(a,i+1,0)).getUTCDate(),l=new Date(Date.UTC(a,i,(()=>{switch(r.vesting_day_of_month){case"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH":return Math.min(n.getUTCDate(),c);case"29_OR_LAST_DAY_OF_MONTH":return Math.min(29,c);case"30_OR_LAST_DAY_OF_MONTH":return Math.min(30,c);case"31_OR_LAST_DAY_OF_MONTH":return Math.min(31,c);default:return Math.min(parseInt(r.vesting_day_of_month,10),c)}})()));return R(l)}const L=(t,e)=>R((0,b.f)(x(t),e)),_=(t,e)=>(0,S.Y)(x(t),x(e)),D=(t,e)=>(0,O.d)(x(t),x(e)),w=(t,e)=>(0,A.n)(x(t),x(e));function T(t,e,r,n){return"MONTHS"===e?N(t,r,n):L(t,r)}function C(t){return!!t&&"object"==typeof t&&"PICKED"===t.type&&"RESOLVED"===t.meta.type}function I(t,e,r=!0){switch(t.base.type){case"DATE":const n=j(t.base.value,t.offsets,e);return r&&D(n,e.asOf)?{type:"UNRESOLVED",blockers:[{type:"DATE_NOT_YET_OCCURRED",date:n}]}:{type:"RESOLVED",date:j(t.base.value,t.offsets,e)};case"EVENT":const s=e.events[t.base.value];return s?{type:"RESOLVED",date:j(s,t.offsets,e)}:{type:"UNRESOLVED",blockers:[{type:"EVENT_NOT_YET_OCCURRED",event:t.base.value}]}}}function j(t,e,r){let n=t;for(const s of e)n="MONTHS"===s.unit?N(n,"PLUS"===s.sign?s.value:-s.value,r):L(n,"PLUS"===s.sign?s.value:-s.value);return n}const k=t=>({type:"IMPOSSIBLE_CONDITION",condition:{base:t.base,offsets:t.offsets,constraints:t.constraints}}),V=t=>{throw new Error(`Unhandled case: ${String(t)}`)},M=(t,e,r,n)=>{const s=_(r,n),o=w(r,n),a=D(r,n);return"BEFORE"===t?e?!s:!(s||o):"AFTER"===t?e?!a:!(a||o):V(t)},F=(t,e)=>[...t.map(t=>t.blockers).flat(),{type:"UNRESOLVED_CONDITION",condition:e}];function U(t,e,r,n){switch(r.type){case"ATOM":const s=I(r.constraint.base,n);return function(t,e,r){const{constraint:n}=r.constraints,s=n.strict;if("IMPOSSIBLE"===e.type)return"BEFORE"==n.type?"UNRESOLVED"===t.type?F([t,e],r):void 0:[k(r)];if("UNRESOLVED"===t.type&&"UNRESOLVED"===e.type)return F([t,e],r);if("RESOLVED"===t.type&&"UNRESOLVED"===e.type){if("BEFORE"===n.type)return;return[k(r)]}if("UNRESOLVED"===t.type&&"RESOLVED"===e.type)return"BEFORE"===n.type?[k(r)]:F([t],r);if("RESOLVED"===t.type&&"RESOLVED"===e.type){const o=t.date,a=e.date;return M(n.type,s,o,a)?[k(r)]:void 0}return V(t)}(e,s,t);case"AND":return r.items.reduce((r,s)=>{const o=U({...t,constraints:s},e,s,n);return o?(r.push(...o),r):r},[]);case"OR":let o=!1;const a=[];for(const i of r.items){const r=U({...t,constraints:i},e,i,n);r&&0!==r.length?a.push(...r):o=!0}if(o)return;return a}}function $(t){const e=[];for(const r of t)"PICKED"!==r.type&&e.push(...r.blockers);return e}function P(t){const e=[];for(const r of t)"IMPOSSIBLE"===r.type&&e.push(...r.blockers);return e}function Y(t,e){let r=t[0].meta,n=t[0].picked;return t.forEach(t=>{const s=function(t,e,r){return("EARLIER_OF"===r?_(e.date,t.date):_(t.date,e.date))?e:t}(r,t.meta,e);s===t.meta&&(n=t.picked),r=s}),{picked:n,meta:r}}const B={selector:"EARLIER_OF",selectorIsSatisfied:t=>t.some(C),partialEmit:!1},z={selector:"LATER_OF",selectorIsSatisfied:t=>t.every(C),partialEmit:!0};function G(t,e){if(t.every(t=>"IMPOSSIBLE"===t.type))return{type:"IMPOSSIBLE",blockers:[{type:"IMPOSSIBLE_SELECTOR",selector:e.selector,blockers:P(t)}]};const r=t.filter(C),n=r.length>0,s=n&&r.length===t.length,o=t.length-r.length;if(e.selectorIsSatisfied(t)){const{picked:t,meta:n}=Y(r,e.selector);return{type:"PICKED",picked:t,meta:n}}if(e.partialEmit&&!s&&n){const{picked:n}=Y(r,e.selector);return{type:"PICKED",picked:n,meta:{type:"UNRESOLVED",blockers:o>1?[{type:"UNRESOLVED_SELECTOR",selector:e.selector,blockers:$(t)}]:[...$(t)]}}}return{type:"UNRESOLVED",blockers:[{type:"UNRESOLVED_SELECTOR",selector:e.selector,blockers:$(t)}]}}function H(t,e){let r;switch(t.type){case"SINGLETON":const n=W(t.vesting_start,e);return"PICKED"===n.type?{type:n.type,picked:t,meta:n.meta}:n;case"EARLIER_OF":return r=t.items.map(t=>H(t,e)),G(r,B);case"LATER_OF":return r=t.items.map(t=>H(t,e)),G(r,z)}}function W(t,e){let r;switch(t.type){case"SINGLETON":const n=function(t,e){const r=I(t,e);if(!t.constraints)return r;const n=U(t,r,t.constraints,e);return n&&0!==n.length?(s=n)&&"object"==typeof s&&s.every(t=>"IMPOSSIBLE"===t.type.split("_")[0])?{type:"IMPOSSIBLE",blockers:n}:{type:"UNRESOLVED",blockers:n}:r;var s}(t,e);return"RESOLVED"===n.type?{type:"PICKED",picked:t,meta:n}:n;case"EARLIER_OF":return r=t.items.map(t=>W(t,e)),G(r,B);case"LATER_OF":return r=t.items.map(t=>W(t,e)),G(r,z)}}function K(t){switch(t.type){case"EVENT_NOT_YET_OCCURRED":return`EVENT ${t.event}`;case"DATE_NOT_YET_OCCURRED":return`DATE ${t.date}`;case"UNRESOLVED_CONDITION":case"IMPOSSIBLE_CONDITION":return e=t.condition,`${Q({...e,type:"SINGLETON"})}`;case"UNRESOLVED_SELECTOR":case"IMPOSSIBLE_SELECTOR":switch(t.selector){case"EARLIER_OF":return`EARLIER OF ( ${t.blockers.map(K).join(", ")} )`;case"LATER_OF":return`LATER OF ( ${t.blockers.map(K).join(", ")} )`}}var e}function Q(t){return`${r=t.base,`${r.type} ${r.value}`}${e=t.offsets,0===e.length?"":` ${e.map(J).join(" ")}`}${t.constraints?` ${q(t.constraints)}`:""}`;var e,r}function q(t){switch(t.type){case"ATOM":return function(t){const e=t.strict?"STRICTLY ":"";return`${e}${t.type} ${Q(t.base)}`}(t.constraint);case"AND":case"OR":const e=t.items.map(q);return`${t.type} ( ${e} )`}}function J(t){return`${"MINUS"===t.sign?"-":"+"}${t.value} ${t.unit.toLowerCase()}`}function Z(t,e){return{amount:e,date:t,meta:{state:"RESOLVED"}}}function X(t,e){const r=Array.from({length:t.length},(r,n)=>function(t,e){return{amount:t,meta:{state:"IMPOSSIBLE",unresolved:e.map(K).join(", ")}}}(t[n],e));return{installments:r,blockers:e}}function tt(t,e,r,n){const s=Array.from({length:t.length},(s,o)=>function(t,e,r,n,s){return{amount:e,meta:{state:"UNRESOLVED",symbolicDate:{type:"START_PLUS",unit:r,steps:t*n},unresolved:s.map(K).join(", ")}}}(o,t[o],e,r,n));return{installments:s,blockers:n}}function et(t,e){const r=Array.from({length:t.length},(r,n)=>function(t,e){return{amount:t,meta:{state:"UNRESOLVED",symbolicDate:{type:"UNRESOLVED_VESTING_START"},unresolved:e.map(K).join(", ")}}}(t[n],e));return{installments:r,blockers:e}}function rt(t,e,r){return{amount:e,meta:{state:"UNRESOLVED",symbolicDate:{type:"UNRESOLVED_CLIFF",date:t},unresolved:r.map(K).join(", ")}}}function nt(t,e,r,n){const s={...n,events:{...n.events,vestingStart:t.meta.date}},o=t.picked.periodicity,a=W(o.cliff,s);if("IMPOSSIBLE"===a.type)return X(r,a.blockers);if("UNRESOLVED"===a.type)return function(t,e,r){return{installments:Array.from({length:e.length},(n,s)=>rt(t[s],e[s],r)),blockers:r}}(e,r,a.blockers);if(C(a))return function(t,e,r){const n=st(t,e,r,({date:t,amount:e})=>Z(t,e));return{installments:n,blockers:[]}}(e,r,a.meta.date);const i=a.meta.blockers;if("LATER_OF"===o.cliff.type){const t=function(t,e){const r=[];for(const s of t.items){const t=W(s,e);"PICKED"===t.type&&"RESOLVED"===t.meta.type&&r.push(t.meta.date)}if(0===r.length)return;let n=r[0];for(let s=1;s<r.length;s++)_(n,r[s])&&(n=r[s]);return n}(o.cliff,s);if(t)return function(t,e,r,n){const s=st(t,e,r,({date:t,amount:e})=>rt(t,e,n));return{installments:s,blockers:n}}(e,r,t,i)}return tt(r,o.type,o.length,i)}function st(t,e,r,n){const s=[];let o=0,a=!1;for(let i=0;i<t.length;i++){const c=t[i],l=e[i],u=_(c,r),f=w(c,r);u?(o+=l,i===t.length-1&&s.push(n({date:r,amount:o}))):f?(o+=l,s.push(n({date:c,amount:o})),a=!0):(!a&&_(r,c)&&o>0&&(s.push(n({date:r,amount:o})),a=!0),s.push(n({date:c,amount:l})))}return s}function ot(t,e){const{ctx:r,statementQuantity:n}=function(t,e){const r=(n=e,{...n,vesting_day_of_month:n.vesting_day_of_month??"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH",allocation_type:n.allocation_type??"CUMULATIVE_ROUND_DOWN"});var n;const s=(o=t.amount,a=r.grantQuantity,"QUANTITY"===o.type?o.value:a*(o.numerator/o.denominator));var o,a;if(s%1!=0||s<0)throw new Error(`expandAllocatedSchedule: totalQuantity must be a positive whole number or zero: ${s}`);return{ctx:r,statementQuantity:s}}(t,e),s=H(t.expr,r);switch(s.type){case"IMPOSSIBLE":return X([n],s.blockers);case"UNRESOLVED":return et([n],s.blockers);case"PICKED":return function(t,e,r){const n=t.picked,s=n.periodicity,{type:o,length:a,occurrences:i}=s;if(i<1)throw new Error(`Expected ${JSON.stringify(t.picked)} to have at least one installment.`);let c=function(t,e,r){if(e<=0)return[];switch(r){case"CUMULATIVE_ROUNDING":{const r=new Array(e).fill(0);for(let n=0;n<e;n++){const s=0===n?0:r.slice(0,n).reduce((t,e)=>t+e,0),o=Math.round((n+1)/e*t);r[n]=o-s}return r}case"CUMULATIVE_ROUND_DOWN":{const r=new Array(e).fill(0);for(let n=0;n<e;n++){const s=0===n?0:r.slice(0,n).reduce((t,e)=>t+e,0),o=Math.floor((n+1)/e*t);r[n]=o-s}return r}case"FRONT_LOADED":{const r=Math.floor(t/e),n=t%e;return Array.from({length:e},(t,e)=>e<n?r+1:r)}case"BACK_LOADED":{const r=Math.floor(t/e),n=t%e;return Array.from({length:e},(t,s)=>s>=e-n?r+1:r)}case"FRONT_LOADED_TO_SINGLE_TRANCHE":{const r=Math.floor(t/e);return[r+t%e,...Array.from({length:e-1},()=>r)]}case"BACK_LOADED_TO_SINGLE_TRANCHE":{const r=Math.floor(t/e),n=t%e;return[...Array.from({length:e-1},()=>r),r+n]}default:return Array.from({length:e},()=>Math.floor(t/e))}}(e,i,r.allocation_type);if("UNRESOLVED"===t.meta.type)return tt(c,o,a,t.meta.blockers);let l=t.meta.date,u=[];for(let m=0;m<i;m++)l=T(l,o,a,r),u.push(l);const{newDates:f,newAmounts:d}=function(t,e,r){const n=st(t,e,r,({date:t,amount:e})=>({date:t,amount:e}));let s=[],o=[];for(const a of n)s.push(a.date),o.push(a.amount);return{newDates:s,newAmounts:o}}(u,c,r.events.grantDate);return u=f,c=d,s.cliff?nt(t,u,c,r):function(t,e){const r=[];return t.forEach((t,n)=>r.push(Z(t,e[n]))),{installments:r,blockers:[]}}(u,c)}(s,n,r)}}function at({installments:t}){return(0,s.jsx)("div",{style:{overflow:"auto"},children:(0,s.jsxs)("table",{className:"table-bordered",style:{width:"100%",marginBottom:"1rem"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{textAlign:"left",padding:"0.875rem 1rem"},children:"Amount"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:"0.875rem 1rem"},children:"Date"})]})}),(0,s.jsx)("tbody",{children:t.map((t,e)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:{padding:"0.875rem 1 rem",fontWeight:"600"},children:t.amount}),(0,s.jsx)("td",{style:{padding:"0.875rem 1 rem",fontFamily:"var(--ifm-font-family-monospace)"},children:"RESOLVED"===t.meta.state?t.date:JSON.stringify(t.meta.symbolicDate)})]},e))})]})})}var it=r(2897);function ct({className:t,...e}){return(0,s.jsx)(it.bL,{...e})}function lt({className:t,...e}){return(0,s.jsx)(it.B8,{className:t,style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",borderBottom:"1px solid var(--ifm-toc-border-color)"},...e})}function ut({className:t,...e}){return(0,s.jsx)(it.l9,{className:t,style:{position:"relative",display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",fontSize:"0.875rem",color:"var(--ifm-color-emphasis-700)",borderRadius:"0.375rem 0.375rem 0 0",outline:"none"},...e})}function ft({className:t,...e}){return(0,s.jsx)(it.UC,{"data-slot":"tabs-content",className:t,style:{padding:"1rem 0",outline:"none"},...e})}function dt({schedules:t,ast:e}){return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card__header",children:(0,s.jsx)("h3",{style:{marginBottom:0},children:"Results"})}),(0,s.jsx)("div",{className:"card__body",children:(0,s.jsxs)(ct,{defaultValue:"Installments",children:[(0,s.jsxs)(lt,{children:[(0,s.jsx)(ut,{value:"Installments",children:"Installments"}),(0,s.jsx)(ut,{value:"AST",children:"AST"})]}),(0,s.jsx)(ft,{value:"Installments",className:"ui-mt-4",children:t.map((t,e)=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(at,{installments:t.installments},e),t.blockers.length>0?(0,s.jsx)("pre",{style:{fontSize:"0.75rem",lineHeight:1.6,overflow:"auto",maxHeight:"60vh",borderRadius:"var(--ifm-code-border-radius)",padding:"0.75rem",background:"var(--ifm-code-background)"},children:JSON.stringify(t.blockers,null,2)}):null]}))}),(0,s.jsx)(ft,{value:"AST",children:(0,s.jsx)("div",{style:{background:"var(--ifm-code-background)",borderRadius:"var(--ifm-code-border-radius)",padding:"1rem"},children:(0,s.jsx)("pre",{style:{fontSize:"0.75rem",lineHeight:1.6,overflow:"auto",maxHeight:"60vh",margin:0},children:JSON.stringify(e,null,2)})})})]})})]})}function mt(t){return new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().slice(0,10)}const pt=t=>{const e=[],r=t=>{if(Array.isArray(t))for(const e of t)r(e);else if(t&&"object"==typeof t){const n=t;"EVENT"===n.type&&"string"==typeof n.value&&e.push(n.value);for(const t of Object.values(n))r(t)}};return r(t),e};function ht({events:t,setEvents:e}){return(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,s.jsx)("label",{htmlFor:"events",style:{fontWeight:"600",color:"var(--ifm-font-color-base)",fontSize:"0.875rem",display:"block",marginBottom:"0.5rem"},children:"Events"}),Object.keys(t).length>0?(0,s.jsx)("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{className:"table-bordered",style:{width:"100%",background:"var(--ifm-color-base)"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{textAlign:"left",padding:"0.75rem 1rem"},children:"Name"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:"0.75rem 1rem"},children:"Date"})]})}),(0,s.jsx)("tbody",{children:Object.entries(t).map(([t,r],n)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:{padding:"0.75rem 1rem"},children:t}),(0,s.jsx)("td",{style:{padding:"0.75rem 1rem"},children:(0,s.jsx)("input",{type:"date",value:r,onChange:r=>((t,r)=>{e(e=>({...e,[t]:r}))})(t,r.target.value),style:{width:"100%",border:"1px solid var(--ifm-color-emphasis-300)",background:"var(--ifm-background-color)",fontSize:"1rem",padding:"0.25rem 0.75rem",borderRadius:"var(--ifm-global-radius)",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.06)",color:"var(--ifm-font-color-base)"}})})]},`${t}-${n}`))})]})}):(0,s.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"var(--ifm-color-emphasis-600)",fontSize:"0.875rem",fontStyle:"italic"},children:"No events specified"})]})}function yt({quantity:t,setQuantity:e,grantDate:r,setGrantDate:n,events:o,setEvents:a}){return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card__header",children:(0,s.jsx)("h3",{style:{marginBottom:0},children:"Grant Configuration"})}),(0,s.jsxs)("div",{className:"card__body",children:[(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,s.jsx)("label",{htmlFor:"quantity",style:{fontWeight:"600",color:"var(--ifm-font-color-base)",fontSize:"0.875rem",display:"block",marginBottom:"0.5rem"},children:"Quantity"}),(0,s.jsx)("input",{id:"quantity",type:"number",min:0,value:Number.isFinite(t)?t:100,onChange:t=>e(Number(t.target.value)||100),style:{width:"100%",border:"1px solid var(--ifm-color-emphasis-300)",background:"var(--ifm-background-color)",fontSize:"1rem",padding:"0.25rem 0.75rem",borderRadius:"var(--ifm-global-radius)",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.06)",color:"var(--ifm-font-color-base)"}})]}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,s.jsx)("label",{htmlFor:"grantDate",style:{fontWeight:"600",color:"var(--ifm-font-color-base)",fontSize:"0.875rem",display:"block",marginBottom:"0.5rem"},children:"Grant Date"}),(0,s.jsx)("input",{id:"grantDate",type:"date",value:mt(r),onChange:t=>n(new Date(t.target.value)),style:{width:"100%",border:"1px solid var(--ifm-color-emphasis-300)",background:"var(--ifm-background-color)",fontSize:"1rem",padding:"0.25rem 0.75rem",borderRadius:"var(--ifm-global-radius)",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.06)",color:"var(--ifm-font-color-base)"}})]})]}),(0,s.jsx)(ht,{events:o,setEvents:a})]})]})}function gt({dsl:t,setDsl:e,error:r}){return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card__header",children:(0,s.jsx)("h3",{style:{marginBottom:0},children:"DSL Statement"})}),(0,s.jsx)("div",{className:"card__body",children:(0,s.jsx)("textarea",{id:"dsl",value:t,onChange:t=>e(t.target.value),rows:5,style:{width:"100%",minWidth:0,border:"1px solid var(--ifm-toc-border-color)",color:"var(--ifm-font-color-base)",borderRadius:"var(--ifm-global-radius)",padding:"0.25rem 0.75rem",fontSize:"1rem",fontFamily:"var(--ifm-font-family-monospace)",lineHeight:"1.6",background:"var(--ifm-background-color)"}})}),r&&""!==t&&(0,s.jsx)("div",{className:"alert alert--danger margin-top--md",children:(0,s.jsx)("pre",{style:{whiteSpace:"pre-wrap",fontSize:"0.875rem",margin:"0.5rem 0 0 0",fontFamily:"var(--ifm-font-family-monospace)"},children:r})})]})}function Et(){const[t,e]=(0,a.useState)(100),[r,n]=(0,a.useState)(new Date),[o,c]=(0,a.useState)({}),[u,f]=(0,a.useState)("VEST OVER 4 years EVERY 3 months CLIFF 12 months"),[d,m]=(0,a.useState)(null),[h,y]=(0,a.useState)(null),[g,E]=(0,a.useState)(null),v=(0,a.useMemo)(()=>mt(new Date),[]),b=(0,a.useCallback)(()=>{try{const e=l(u),n=e.map(p);m(n);const s=Array.from(new Set(pt(n))),a={};for(const t of s)"grantDate"!==t&&"vestingStart"!==t&&(a[t]=o[t]??void 0);c(a);const i={events:{grantDate:mt(r),...a},grantQuantity:t,asOf:v,vesting_day_of_month:"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH",allocation_type:"CUMULATIVE_ROUND_DOWN"},f=n.map(t=>ot(t,i));y(f),E(null)}catch(e){m(null),y(null),E(e?.message??String(e))}},[u,t,r,o,v]);return(0,a.useEffect)(()=>{const t=window.setTimeout(b,250);return()=>window.clearTimeout(t)},[b,u,t,r,o]),(0,s.jsx)(i.A,{children:()=>(0,s.jsx)("div",{className:"padding--md",style:{background:"var(--ifm-background-surface-color)"},children:(0,s.jsx)("div",{style:{maxWidth:"auto",margin:"0 auto"},children:(0,s.jsxs)("div",{className:"card shadow--md",children:[(0,s.jsxs)("div",{className:"card__header",style:{background:"var(--ifm-color-emphasis-200)",borderBottom:"1px solid var(--ifm-color-emphasis-300)"},children:[(0,s.jsx)("h1",{style:{marginBottom:"0.5rem",color:"var(--ifm-font-color-base)"},children:"Vestlang Playground"}),(0,s.jsx)("p",{style:{color:"var(--ifm-color-emphasis-700)",marginBottom:"1rem"},children:"Configure your vesting schedule and see results in real-time"})]}),(0,s.jsx)("div",{className:"card__body",children:(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"2rem"},children:[(0,s.jsx)(yt,{quantity:t,setQuantity:e,grantDate:r,setGrantDate:n,events:o,setEvents:c}),(0,s.jsx)(gt,{dsl:u,setDsl:f,error:g}),h&&d&&(0,s.jsx)(dt,{schedules:h,ast:d})]})})]})})})})}const vt={title:"Playground",hide_title:!0,sidebar_position:5},bt=void 0,St={},Ot=[];function At(t){return(0,s.jsx)(Et,{})}function xt(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(At,{...t})}):At()}}}]);