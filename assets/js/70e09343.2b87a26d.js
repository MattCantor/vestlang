"use strict";(self.webpackChunk_vestlang_docs=self.webpackChunk_vestlang_docs||[]).push([[462],{4969:(t,e,n)=>{n.d(e,{A:()=>o});n(9430);var r=n(8970),s=n(5270);function o({children:t,fallback:e}){return(0,r.A)()?(0,s.jsx)(s.Fragment,{children:t?.()}):e??null}},7678:(t,e,n)=>{n.d(e,{R:()=>a,x:()=>i});var r=n(9430);const s={},o=r.createContext(s);function a(t){const e=r.useContext(o);return r.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:a(t.components),r.createElement(o.Provider,{value:e},t.children)}},7852:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>yt,contentTitle:()=>mt,default:()=>St,frontMatter:()=>Et,metadata:()=>r,toc:()=>gt});const r=JSON.parse('{"id":"playground","title":"Playground","description":"","source":"@site/docs/playground.mdx","sourceDirName":".","slug":"/playground","permalink":"/vestlang/playground","draft":false,"unlisted":false,"editUrl":"https://github.com/MattCantor/vestlang/docs/playground.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Playground","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Command Line Interface","permalink":"/vestlang/cli"}}');var s=n(5270),o=n(7678),a=n(9430),i=n(4969);class c extends SyntaxError{constructor(t,e,n,r){super(t),this.expected=e,this.found=n,this.location=r,this.name="SyntaxError"}format(t){let e="Error: "+this.message;if(this.location){let n=null;const r=t.find(t=>t.source===this.location.source);r&&(n=r.text.split(/\r\n|\n|\r/g));const s=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,a=this.location.source+":"+o.line+":"+o.column;if(n){const t=this.location.end,r="".padEnd(o.line.toString().length," "),i=n[s.line-1],c=(s.line===t.line?t.column:i.length+1)-s.column||1;e+="\n --\x3e "+a+"\n"+r+" |\n"+o.line+" | "+i+"\n"+r+" | "+"".padEnd(s.column-1," ")+"".padEnd(c,"^")}else e+="\n at "+a}return e}static buildMessage(t,e){function n(t){return t.codePointAt(0).toString(16).toUpperCase()}const r=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function s(t){return r?t.replace(r,t=>"\\u{"+n(t)+"}"):t}function o(t){return s(t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+n(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+n(t)))}function a(t){return s(t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+n(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+n(t)))}const i={literal:t=>'"'+o(t.text)+'"',class(t){const e=t.parts.map(t=>Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t));return"["+(t.inverted?"^":"")+e.join("")+"]"+(t.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:t=>t.description};function c(t){return i[t.type](t)}return"Expected "+function(t){const e=t.map(c);if(e.sort(),e.length>0){let t=1;for(let n=1;n<e.length;n++)e[n-1]!==e[n]&&(e[t]=e[n],t++);e.length=t}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."}}function u(t,e){const n={},r=(e=void 0!==e?e:{}).grammarSource,s={Start:Jt};let o=Jt;const a="vest",i="[",u="]",l="and",f="or",p=",",d=".",h="/",E="day",m="s",y="month",g="week",O="year",S="strictly",A="date",v="-",b="grantdate",L="grant_date",R="grant-date",D="vestingstart",N="vesting_start",T="vesting-start",_="event",x="before",C="after",w="(",I=")",M="earlier",j="later",U="of",V="over",F="every",k="from",$="cliff",P=/^[ \t\r\n]/,Y=/^[+\-]/,B=/^[0-9]/,G=/^[0-1]/,z=/^[A-Za-z_]/,H=/^[A-Za-z0-9_]/,K=/^[0-3]/,Q=Gt("VEST",!0),W=Gt("[",!1),J=Gt("]",!1),Z={type:"any"},q=zt([" ","\t","\r","\n"],!1,!1,!1),X=Gt("AND",!0),tt=Gt("OR",!0),et=Gt(",",!1),nt=zt(["+","-"],!1,!1,!1),rt=zt([["0","9"]],!1,!1,!1),st=Gt(".",!1),ot=zt([["0","1"]],!1,!1,!1),at=Gt("/",!1),it=Gt("day",!0),ct=Gt("s",!1),ut=Gt("month",!0),lt=Gt("week",!0),ft=Gt("year",!0),pt=zt([["A","Z"],["a","z"],"_"],!1,!1,!1),dt=zt([["A","Z"],["a","z"],["0","9"],"_"],!1,!1,!1),ht=Gt("STRICTLY",!0),Et=Gt("DATE",!0),mt=Gt("-",!1),yt=zt([["0","3"]],!1,!1,!1),gt=Gt("grantdate",!0),Ot=Gt("grant_date",!0),St=Gt("grant-date",!0),At=Gt("vestingstart",!0),vt=Gt("vesting_start",!0),bt=Gt("vesting-start",!0),Lt=Gt("EVENT",!0),Rt=Gt("BEFORE",!0),Dt=Gt("AFTER",!0),Nt=Gt("(",!1),Tt=Gt(")",!1),_t=Gt("EARLIER",!0),xt=Gt("LATER",!0),Ct=Gt("OF",!0),wt=Gt("OVER",!0),It=Gt("EVERY",!0),Mt=Gt("FROM",!0),jt=Gt("CLIFF",!0);let Ut=0|e.peg$currPos,Vt=Ut;const Ft=[{line:1,column:1}];let kt,$t=Ut,Pt=e.peg$maxFailExpected||[],Yt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');o=s[e.startRule]}function Bt(t,e){throw function(t,e){return new c(t,null,null,e)}(t,e=void 0!==e?e:Kt(Vt,Ut))}function Gt(t,e){return{type:"literal",text:t,ignoreCase:e}}function zt(t,e,n,r){return{type:"class",parts:t,inverted:e,ignoreCase:n,unicode:r}}function Ht(e){let n,r=Ft[e];if(r)return r;if(e>=Ft.length)n=Ft.length-1;else for(n=e;!Ft[--n];);for(r=Ft[n],r={line:r.line,column:r.column};n<e;)10===t.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Ft[e]=r,r}function Kt(t,e,n){const s=Ht(t),o=Ht(e),a={source:r,start:{offset:t,line:s.line,column:s.column},end:{offset:e,line:o.line,column:o.column}};return n&&r&&"function"==typeof r.offset&&(a.start=r.offset(a.start),a.end=r.offset(a.end)),a}function Qt(t){Ut<$t||(Ut>$t&&($t=Ut,Pt=[]),Pt.push(t))}function Wt(t,e,n){return new c(c.buildMessage(t,e),t,e,n)}function Jt(){let e,r,s,o,a;return e=Ut,r=qt(),s=Ut,o=function(){let e,r,s,o,a,c,l,f,p;e=Ut,91===t.charCodeAt(Ut)?(r=i,Ut++):(r=n,0===Yt&&Qt(W));if(r!==n)if(s=qt(),o=Zt(),o!==n){for(a=[],c=Ut,l=ee(),l!==n?(f=Zt(),f!==n?(l=[l,f],c=l):(Ut=c,c=n)):(Ut=c,c=n);c!==n;)a.push(c),c=Ut,l=ee(),l!==n?(f=Zt(),f!==n?(l=[l,f],c=l):(Ut=c,c=n)):(Ut=c,c=n);c=qt(),l=ee(),l===n&&(l=null),f=qt(),93===t.charCodeAt(Ut)?(p=u,Ut++):(p=n,0===Yt&&Qt(J)),p!==n?(Vt=e,e=ve(o,a)):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;return e}(),o!==n&&(Vt=s),s=o,s===n&&(s=Ut,o=Zt(),o!==n&&(Vt=s,o=[o]),s=o),s!==n?(o=qt(),a=function(){let e,r;e=Ut,Yt++,t.length>Ut?(r=t.charAt(Ut),Ut++):(r=n,0===Yt&&Qt(Z));Yt--,r===n?e=void 0:(Ut=e,e=n);return e}(),a!==n?(Vt=e,e=s):(Ut=e,e=n)):(Ut=e,e=n),e}function Zt(){let e,r,s,o,i,c,u,l;var f;return e=Ut,r=qt(),s=function(){let e,r,s,o;e=Ut,r=qt(),s=function(){let e,r;e=Ut,r=function(){let e,r,s,o,a,i,c;e=Ut,r=Ut,s=Ut,46===t.charCodeAt(Ut)?(o=d,Ut++):(o=n,0===Yt&&Qt(st));if(o!==n){if(a=[],i=t.charAt(Ut),B.test(i)?Ut++:(i=n,0===Yt&&Qt(rt)),i!==n)for(;i!==n;)a.push(i),i=t.charAt(Ut),B.test(i)?Ut++:(i=n,0===Yt&&Qt(rt));else a=n;a!==n?(o=[o,a],s=o):(Ut=s,s=n)}else Ut=s,s=n;if(s===n)if(s=Ut,o=t.charAt(Ut),G.test(o)?Ut++:(o=n,0===Yt&&Qt(ot)),o!==n)if(46===t.charCodeAt(Ut)?(a=d,Ut++):(a=n,0===Yt&&Qt(st)),a!==n){if(i=[],c=t.charAt(Ut),B.test(c)?Ut++:(c=n,0===Yt&&Qt(rt)),c!==n)for(;c!==n;)i.push(c),c=t.charAt(Ut),B.test(c)?Ut++:(c=n,0===Yt&&Qt(rt));else i=n;i!==n?(o=[o,a,i],s=o):(Ut=s,s=n)}else Ut=s,s=n;else Ut=s,s=n;r=s!==n?t.substring(r,Ut):s;r!==n&&(Vt=e);return e=r,e}(),r!==n&&(Vt=e,r=function(t){const e=parseFloat(t);(e<0||e>1)&&Bt("Decimal portion must be between 0 and 1 inclusive");const n=((t.startsWith(".")?["0",t.slice(1)]:t.split("."))[1]??"").length,r=Math.pow(10,n);return Se(Math.round(e*r),r)}(r));return e=r,e}(),s===n&&(s=function(){let e,r,s,o,a,i;e=Ut,r=ne(),r!==n?(s=qt(),47===t.charCodeAt(Ut)?(o=h,Ut++):(o=n,0===Yt&&Qt(at)),o!==n?(a=qt(),i=ne(),i!==n?(Vt=e,e=Se(r,i)):(Ut=e,e=n)):(Ut=e,e=n)):(Ut=e,e=n);return e}(),s===n&&(s=function(){let t,e;t=Ut,e=ne(),e!==n&&(Vt=t,e={type:"QUANTITY",value:e});return t=e,t}()));s!==n?(o=qt(),Vt=e,e=s):(Ut=e,e=n);return e}(),s===n&&(s=null),o=qt(),i=t.substr(Ut,4),i.toLowerCase()===a?Ut+=4:(i=n,0===Yt&&Qt(Q)),i!==n?(c=qt(),u=ye(),u!==n?(l=qt(),Vt=e,f=u,e={amount:s??Se(1,1),expr:f}):(Ut=e,e=n)):(Ut=e,e=n),e}function qt(){let e,r;for(e=[],r=t.charAt(Ut),P.test(r)?Ut++:(r=n,0===Yt&&Qt(q));r!==n;)e.push(r),r=t.charAt(Ut),P.test(r)?Ut++:(r=n,0===Yt&&Qt(q));return e}function Xt(){let e,r,s,o;return e=Ut,r=qt(),s=t.substr(Ut,3),s.toLowerCase()===l?Ut+=3:(s=n,0===Yt&&Qt(X)),s!==n?(o=qt(),Vt=e,e="AND"):(Ut=e,e=n),e}function te(){let e,r,s,o;return e=Ut,r=qt(),s=t.substr(Ut,2),s.toLowerCase()===f?Ut+=2:(s=n,0===Yt&&Qt(tt)),s!==n?(o=qt(),Vt=e,e="OR"):(Ut=e,e=n),e}function ee(){let e,r,s,o;return e=Ut,r=qt(),44===t.charCodeAt(Ut)?(s=p,Ut++):(s=n,0===Yt&&Qt(et)),s!==n?(o=qt(),r=[r,s,o],e=r):(Ut=e,e=n),e}function ne(){let e,r,s,o;if(e=Ut,r=Ut,s=[],o=t.charAt(Ut),B.test(o)?Ut++:(o=n,0===Yt&&Qt(rt)),o!==n)for(;o!==n;)s.push(o),o=t.charAt(Ut),B.test(o)?Ut++:(o=n,0===Yt&&Qt(rt));else s=n;return r=s!==n?t.substring(r,Ut):s,r!==n?(s=Ut,Yt++,46===t.charCodeAt(Ut)?(o=d,Ut++):(o=n,0===Yt&&Qt(st)),Yt--,o===n?s=void 0:(Ut=s,s=n),s!==n?(Vt=e,e=parseInt(r,10)):(Ut=e,e=n)):(Ut=e,e=n),e}function re(){let e,r,s,o,a,i;return e=Ut,r=function(){let e;return e=t.charAt(Ut),Y.test(e)?Ut++:(e=n,0===Yt&&Qt(nt)),e}(),r===n&&(r=null),s=qt(),o=ne(),o!==n?(a=qt(),i=function(){let e,r,s;e=Ut,r=t.substr(Ut,3),r.toLowerCase()===E?Ut+=3:(r=n,0===Yt&&Qt(it));r!==n?(115===t.charCodeAt(Ut)?(s=m,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="DAYS"):(Ut=e,e=n);e===n&&(e=Ut,r=t.substr(Ut,5),r.toLowerCase()===y?Ut+=5:(r=n,0===Yt&&Qt(ut)),r!==n?(115===t.charCodeAt(Ut)?(s=m,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="MONTHS"):(Ut=e,e=n),e===n&&(e=Ut,r=t.substr(Ut,4),r.toLowerCase()===g?Ut+=4:(r=n,0===Yt&&Qt(lt)),r!==n?(115===t.charCodeAt(Ut)?(s=m,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="weeks"):(Ut=e,e=n),e===n&&(e=Ut,r=t.substr(Ut,4),r.toLowerCase()===O?Ut+=4:(r=n,0===Yt&&Qt(ft)),r!==n?(115===t.charCodeAt(Ut)?(s=m,Ut++):(s=n,0===Yt&&Qt(ct)),s===n&&(s=null),Vt=e,e="years"):(Ut=e,e=n))));return e}(),i!==n?(Vt=e,e=function(t,e,n){const r="-"===t?"MINUS":"PLUS";switch(n){case"weeks":return ge(7*e,"DAYS",r);case"years":return ge(12*e,"MONTHS",r);case"DAYS":case"MONTHS":return ge(e,n,r);default:Bt("Unknown duration unit: "+n)}}(r,o,i)):(Ut=e,e=n)):(Ut=e,e=n),e}function se(){let e,r,s,o;return e=Ut,r=t.substr(Ut,5),r.toLowerCase()===_?Ut+=5:(r=n,0===Yt&&Qt(Lt)),r!==n?(s=qt(),o=function(){let e,r;return e=Ut,r=t.substr(Ut,9),r.toLowerCase()===b?Ut+=9:(r=n,0===Yt&&Qt(gt)),r!==n&&(Vt=e,r="grantDate"),e=r,e===n&&(e=Ut,r=t.substr(Ut,10),r.toLowerCase()===L?Ut+=10:(r=n,0===Yt&&Qt(Ot)),r!==n&&(Vt=e,r="grantDate"),e=r,e===n&&(e=Ut,r=t.substr(Ut,10),r.toLowerCase()===R?Ut+=10:(r=n,0===Yt&&Qt(St)),r!==n&&(Vt=e,r="grantDate"),e=r,e===n&&(e=Ut,r=t.substr(Ut,12),r.toLowerCase()===D?Ut+=12:(r=n,0===Yt&&Qt(At)),r!==n&&(Vt=e,r="vestingStart"),e=r,e===n&&(e=Ut,r=t.substr(Ut,13),r.toLowerCase()===N?Ut+=13:(r=n,0===Yt&&Qt(vt)),r!==n&&(Vt=e,r="vestingStart"),e=r,e===n&&(e=Ut,r=t.substr(Ut,13),r.toLowerCase()===T?Ut+=13:(r=n,0===Yt&&Qt(bt)),r!==n&&(Vt=e,r="vestingStart"),e=r))))),e}(),o===n&&(o=function(){let e,r,s,o,a;if(e=Ut,r=Ut,s=t.charAt(Ut),z.test(s)?Ut++:(s=n,0===Yt&&Qt(pt)),s!==n){for(o=[],a=t.charAt(Ut),H.test(a)?Ut++:(a=n,0===Yt&&Qt(dt));a!==n;)o.push(a),a=t.charAt(Ut),H.test(a)?Ut++:(a=n,0===Yt&&Qt(dt));s=[s,o],r=s}else Ut=r,r=n;return e=r!==n?t.substring(e,Ut):r,e}()),o!==n?(Vt=e,e=function(t){return{type:"EVENT",value:t}}(o)):(Ut=e,e=n)):(Ut=e,e=n),e}function oe(){let e,r,s,o,a,i;if(e=Ut,r=se(),r===n&&(r=function(){let e,r,s,o,a,i,c,u,l,f,p,d,h,E,m;return e=Ut,r=t.substr(Ut,4),r.toLowerCase()===A?Ut+=4:(r=n,0===Yt&&Qt(Et)),r!==n?(s=qt(),o=Ut,a=Ut,i=t.charAt(Ut),B.test(i)?Ut++:(i=n,0===Yt&&Qt(rt)),i!==n?(c=t.charAt(Ut),B.test(c)?Ut++:(c=n,0===Yt&&Qt(rt)),c!==n?(u=t.charAt(Ut),B.test(u)?Ut++:(u=n,0===Yt&&Qt(rt)),u!==n?(l=t.charAt(Ut),B.test(l)?Ut++:(l=n,0===Yt&&Qt(rt)),l!==n?(45===t.charCodeAt(Ut)?(f=v,Ut++):(f=n,0===Yt&&Qt(mt)),f!==n?(p=t.charAt(Ut),G.test(p)?Ut++:(p=n,0===Yt&&Qt(ot)),p!==n?(d=t.charAt(Ut),B.test(d)?Ut++:(d=n,0===Yt&&Qt(rt)),d!==n?(45===t.charCodeAt(Ut)?(h=v,Ut++):(h=n,0===Yt&&Qt(mt)),h!==n?(E=t.charAt(Ut),K.test(E)?Ut++:(E=n,0===Yt&&Qt(yt)),E!==n?(m=t.charAt(Ut),B.test(m)?Ut++:(m=n,0===Yt&&Qt(rt)),m!==n?(i=[i,c,u,l,f,p,d,h,E,m],a=i):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n)):(Ut=a,a=n),o=a!==n?t.substring(o,Ut):a,o!==n?(Vt=e,y=o,e={type:"DATE",value:y}):(Ut=e,e=n)):(Ut=e,e=n),e;var y}()),r!==n){for(s=[],o=Ut,a=qt(),i=re(),i!==n?(a=[a,i],o=a):(Ut=o,o=n);o!==n;)s.push(o),o=Ut,a=qt(),i=re(),i!==n?(a=[a,i],o=a):(Ut=o,o=n);o=Ut,a=qt(),i=le(),i!==n?(a=[a,i],o=a):(Ut=o,o=n),o===n&&(o=null),Vt=e,e=function(t,e,n){const r={type:"SINGLETON",base:t,offsets:Oe(e.map(t=>t[1]))};return n&&(r.constraints=n[1]),r}(r,s,o)}else Ut=e,e=n;return e}function ae(){let e,r,s,o,a,i;var c,u;return e=Ut,r=function(){let e,r;return e=Ut,r=t.substr(Ut,8),r.toLowerCase()===S?Ut+=8:(r=n,0===Yt&&Qt(ht)),r!==n&&(Vt=e,r=!0),e=r,e}(),r===n&&(r=null),s=qt(),o=t.substr(Ut,6),o.toLowerCase()===x?Ut+=6:(o=n,0===Yt&&Qt(Rt)),o===n&&(o=t.substr(Ut,5),o.toLowerCase()===C?Ut+=5:(o=n,0===Yt&&Qt(Dt))),o!==n?(a=qt(),i=oe(),i!==n?(Vt=e,c=r,u=i,e={type:"ATOM",constraint:{type:o.toUpperCase(),base:u,strict:!!c}}):(Ut=e,e=n)):(Ut=e,e=n),e}function ie(){let e,r,s,o,a,i,c,u,p;if(e=Ut,r=t.substr(Ut,3),r.toLowerCase()===l?Ut+=3:(r=n,0===Yt&&Qt(X)),r===n&&(r=t.substr(Ut,2),r.toLowerCase()===f?Ut+=2:(r=n,0===Yt&&Qt(tt))),r!==n)if(40===t.charCodeAt(Ut)?(s=w,Ut++):(s=n,0===Yt&&Qt(Nt)),s!==n)if(o=qt(),a=le(),a!==n){for(i=[],c=Ut,u=ee(),u!==n?(p=le(),p!==n?(u=[u,p],c=u):(Ut=c,c=n)):(Ut=c,c=n);c!==n;)i.push(c),c=Ut,u=ee(),u!==n?(p=le(),p!==n?(u=[u,p],c=u):(Ut=c,c=n)):(Ut=c,c=n);c=qt(),41===t.charCodeAt(Ut)?(u=I,Ut++):(u=n,0===Yt&&Qt(Tt)),u!==n?(Vt=e,d=a,h=i,e=be(r.toUpperCase(),Ae(d,h))):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;var d,h;return e}function ce(){let e;return e=function(){let e,r,s,o,a,i;return e=Ut,40===t.charCodeAt(Ut)?(r=w,Ut++):(r=n,0===Yt&&Qt(Nt)),r!==n?(s=qt(),o=le(),o!==n?(a=qt(),41===t.charCodeAt(Ut)?(i=I,Ut++):(i=n,0===Yt&&Qt(Tt)),i!==n?(Vt=e,e=o):(Ut=e,e=n)):(Ut=e,e=n)):(Ut=e,e=n),e}(),e===n&&(e=ie(),e===n&&(e=ae())),e}function ue(){let t,e,r,s,o,a;if(t=Ut,e=ce(),e!==n){for(r=[],s=Ut,o=Xt(),o!==n?(a=ce(),a!==n?(o=[o,a],s=o):(Ut=s,s=n)):(Ut=s,s=n);s!==n;)r.push(s),s=Ut,o=Xt(),o!==n?(a=ce(),a!==n?(o=[o,a],s=o):(Ut=s,s=n)):(Ut=s,s=n);Vt=t,i=e,t=0===(c=r).length?i:be("AND",Ae(i,c))}else Ut=t,t=n;var i,c;return t}function le(){let t,e,r,s,o,a;if(t=Ut,e=ue(),e!==n){for(r=[],s=Ut,o=te(),o!==n?(a=ue(),a!==n?(o=[o,a],s=o):(Ut=s,s=n)):(Ut=s,s=n);s!==n;)r.push(s),s=Ut,o=te(),o!==n?(a=ue(),a!==n?(o=[o,a],s=o):(Ut=s,s=n)):(Ut=s,s=n);Vt=t,i=e,t=0===(c=r).length?i:be("OR",Ae(i,c))}else Ut=t,t=n;var i,c;return t}function fe(){let e;return e=function(){let e,r,s,o,a,i,c,u,l,f,p,d;e=Ut,r=t.substr(Ut,7),r.toLowerCase()===M?Ut+=7:(r=n,0===Yt&&Qt(_t));r===n&&(r=t.substr(Ut,5),r.toLowerCase()===j?Ut+=5:(r=n,0===Yt&&Qt(xt)));if(r!==n)if(s=qt(),o=t.substr(Ut,2),o.toLowerCase()===U?Ut+=2:(o=n,0===Yt&&Qt(Ct)),o!==n)if(a=qt(),40===t.charCodeAt(Ut)?(i=w,Ut++):(i=n,0===Yt&&Qt(Nt)),i!==n)if(c=qt(),u=fe(),u!==n){for(l=[],f=Ut,p=ee(),p!==n?(d=fe(),d!==n?(p=[p,d],f=p):(Ut=f,f=n)):(Ut=f,f=n);f!==n;)l.push(f),f=Ut,p=ee(),p!==n?(d=fe(),d!==n?(p=[p,d],f=p):(Ut=f,f=n)):(Ut=f,f=n);f=qt(),41===t.charCodeAt(Ut)?(p=I,Ut++):(p=n,0===Yt&&Qt(Tt)),p!==n?(Vt=e,h=u,E=l,e={type:"EARLIER"===r.toUpperCase()?"EARLIER_OF":"LATER_OF",items:ve(h,E)}):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;var h,E;return e}(),e===n&&(e=oe(),e===n&&(e=re())),e}function pe(){let e,r,s,o;var a;return e=Ut,r=t.substr(Ut,4),r.toLowerCase()===V?Ut+=4:(r=n,0===Yt&&Qt(wt)),r!==n?(s=qt(),o=re(),o!==n?(Vt=e,"MINUS"===(a=o).sign&&Bt("OVER may not include a negative duration"),e=a):(Ut=e,e=n)):(Ut=e,e=n),e}function de(){let e,r,s,o;var a;return e=Ut,r=t.substr(Ut,5),r.toLowerCase()===F?Ut+=5:(r=n,0===Yt&&Qt(It)),r!==n?(s=qt(),o=re(),o!==n?(Vt=e,"MINUS"===(a=o).sign&&Bt("EVERY may not include a negative duration"),e=a):(Ut=e,e=n)):(Ut=e,e=n),e}function he(){let t,e,r,s;return t=Ut,e=pe(),e!==n?(r=qt(),s=de(),s!==n?(Vt=t,t=function(t,e){t.unit!==e.unit&&Bt("EVERY and OVER must have the same units");const n=t.value,r=e.value;return 0===n&&0!==r&&Bt("EVERY must be non-zero when OVER is non-zero"),0===r&&0!==n&&Bt("OVER must be non-zero when EVERY is non-zero"),0===n&&0===r?{type:"DAYS",length:0,occurrences:1}:(n%r!==0&&Bt("OVER must be a multiple of every"),{type:t.unit,length:r,occurrences:n/r})}(e,s)):(Ut=t,t=n)):(Ut=t,t=n),t===n&&(t=Ut,e=pe(),e!==n&&(Vt=t,e=void Bt("EVERY must be provided when OVER is present")),t=e,t===n&&(t=Ut,e=de(),e!==n&&(Vt=t,e=void Bt("OVER must be provided when EVERY is present")),t=e,t===n&&(t=Ut,e="",Vt=t,e={type:"DAYS",length:0,occurrences:1},t=e))),t}function Ee(){let e,r,s,o;return e=Ut,r=t.substr(Ut,4),r.toLowerCase()===k?Ut+=4:(r=n,0===Yt&&Qt(Mt)),r!==n?(s=qt(),o=oe(),o===n&&(o=fe()),o!==n?(Vt=e,e=function(t){if("SINGLETON"===t.type&&"EVENT"===t.base.type&&"vestingStart"===t.base.value)throw new SyntaxError("vestingStart is a reserved system event that cannot be used in a `FROM` statement. Pick a different event name.");return t}(o)):(Ut=e,e=n)):(Ut=e,e=n),e}function me(){let e,r,s,o;return e=Ut,r=t.substr(Ut,5),r.toLowerCase()===$?Ut+=5:(r=n,0===Yt&&Qt(jt)),r!==n?(s=qt(),o=oe(),o===n&&(o=fe()),o!==n?(Vt=e,e=function(t){if("SINGLETONE"===t.type&&"EVENT"===t.base.type&&"grantDate"===t.base.value)throw new SyntaxError("grantDate is a reserved system event that cannot be used in a `CLIFF` statement. The `CLIFF` will refer to the computed `vestingStart` date, unless an alternative event is provided.");return t}(o)):(Ut=e,e=n)):(Ut=e,e=n),e}function ye(){let e;return e=function(){let e,r,s,o,a,i,c,u,l,f,p,d;e=Ut,r=t.substr(Ut,7),r.toLowerCase()===M?Ut+=7:(r=n,0===Yt&&Qt(_t));r===n&&(r=t.substr(Ut,5),r.toLowerCase()===j?Ut+=5:(r=n,0===Yt&&Qt(xt)));if(r!==n)if(s=qt(),o=t.substr(Ut,2),o.toLowerCase()===U?Ut+=2:(o=n,0===Yt&&Qt(Ct)),o!==n)if(a=qt(),40===t.charCodeAt(Ut)?(i=w,Ut++):(i=n,0===Yt&&Qt(Nt)),i!==n)if(c=qt(),u=ye(),u!==n){for(l=[],f=Ut,p=ee(),p!==n?(d=ye(),d!==n?(p=[p,d],f=p):(Ut=f,f=n)):(Ut=f,f=n);f!==n;)l.push(f),f=Ut,p=ee(),p!==n?(d=ye(),d!==n?(p=[p,d],f=p):(Ut=f,f=n)):(Ut=f,f=n);f=qt(),41===t.charCodeAt(Ut)?(p=I,Ut++):(p=n,0===Yt&&Qt(Tt)),p!==n?(Vt=e,h=u,E=l,e={type:"EARLIER"===r.toUpperCase()?"EARLIER_OF":"LATER_OF",items:ve(h,E)}):(Ut=e,e=n)}else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;else Ut=e,e=n;var h,E;return e}(),e===n&&(e=function(){let t,e,r,s,o,a;return t=Ut,e=Ee(),e===n&&(e=null),r=qt(),s=he(),s!==n?(o=qt(),a=me(),a===n&&(a=null),Vt=t,t=function(t,e,n){const r={type:"SINGLETON",vesting_start:t,periodicity:e};return n&&(r.periodicity.cliff=n),r}(e,s,a)):(Ut=t,t=n),t}()),e}function ge(t,e,n){return{type:"DURATION",value:t,unit:e,sign:n}}function Oe(t){if(!t||0===t.length)return[];let e=0,n=0;for(const s of t){const t=Math.abs(s.value),r="MINUS"===s.sign?-t:t;if("MONTHS"===s.unit)e+=r;else{if("DAYS"!==s.unit)throw new SyntaxError(`Unknown offset type ${s.unit}`);n+=r}}const r=[];return 0!==e&&r.push(ge(Math.abs(e),"MONTHS",e<0?"MINUS":"PLUS")),0!==n&&r.push(ge(Math.abs(n),"DAYS",n<0?"MINUS":"PLUS")),r}function Se(t,e){if(0===e)throw new SyntaxError("Denominator cannot be 0");e<0&&(t=-t,e=-e);const n=function(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){const n=t%e;t=e,e=n}return t||1}(Math.abs(t),e);return{type:"PORTION",numerator:t/n,denominator:e/n}}function Ae(t,e){return[t,...e.map(t=>t[1])]}function ve(t,e){const n=Ae(t,e);if(n.length<2)throw new SyntaxError("At least two items are required");return n}function be(t,e){const n=t.toUpperCase(),r=[];for(const s of e)s&&s.type===n&&Array.isArray(s.items)?r.push(...s.items):r.push(s);if(1===r.length)return r[0];if(r.length<2)throw new SyntaxError(`${n} requires at least two items`);return{type:n,items:r}}kt=o();const Le=kt!==n&&Ut===t.length;function Re(){throw kt!==n&&Ut<t.length&&Qt({type:"end"}),Wt(Pt,$t<t.length?function(e=Ut){const n=t.codePointAt(e);return void 0===n?"":String.fromCodePoint(n)}($t):null,$t<t.length?Kt($t,$t+1):Kt($t,$t))}return e.peg$library?{peg$result:kt,peg$currPos:Ut,peg$FAILED:n,peg$maxFailExpected:Pt,peg$maxFailPos:$t,peg$success:Le,peg$throw:Le?void 0:Re}:Le?kt:void Re()}function l(t){const e=new WeakSet,n=t=>{if(null===t||"object"!=typeof t)return t;if(e.has(t))return"[Circular]";if(e.add(t),Array.isArray(t))return t.map(n);const r=Object.keys(t).sort(),s={};for(const e of r)s[e]=n(t[e]);return s};return JSON.stringify(n(t))}function f(t,e){let n=t.items.map(e);if(n=n.flatMap(e=>e.type===t.type?e.items:[e]),n.sort((t,e)=>l(t).localeCompare(l(e))),n=function(t){const e=new Set,n=[];for(const r of t){const t=l(r);e.has(t)||(e.add(t),n.push(r))}return n}(n),1===n.length)return n[0];if(0===n.length)throw new Error(`${t.type} became empty after normalization`);return{...t,items:n}}function p(t){return t.constraints?{...t,constraints:d(t.constraints)}:t}function d(t){switch(t.type){case"ATOM":return function(t){const e=p(t.constraint.base);return{type:"ATOM",constraint:{...t.constraint,base:e}}}(t);case"AND":case"OR":return f(t,d);default:throw new Error(`normalizeCondition: unexpected condition type ${t?.type}`)}}function h(t){return{amount:t.amount,expr:E(t.expr)}}function E(t){switch(t.type){case"SINGLETON":return function(t){const e=y(t.vesting_start??{type:"SINGLETON",base:{type:"EVENT",value:"grantDate"},offsets:[]}),n=t.periodicity.cliff?{...t.periodicity,cliff:g(t.periodicity.cliff)}:{...t.periodicity};return{...t,vesting_start:e,periodicity:n}}(t);case"EARLIER_OF":case"LATER_OF":return f(t,E);default:throw new Error(`normalizeScheduleExpr: unexpected ScheduleExpr type ${t?.type}`)}}function m(t,e){switch(t.type){case"DURATION":return{type:"SINGLETON",base:{type:"EVENT",value:e},offsets:[t]};case"LATER_OF":case"EARLIER_OF":return f(t,"grantDate"===e?y:g);case"SINGLETON":return O(t);default:throw new Error(`normalizeCliff: unexpected cliff type ${t?.type}`)}}function y(t){return m(t,"grantDate")}function g(t){return m(t,"vestingStart")}function O(t){switch(t.type){case"SINGLETON":return p(t);case"EARLIER_OF":case"LATER_OF":return f(t,O);default:throw new Error(`normalizeVestingNodeExpr: unexpected VestingNode type ${t?.type}`)}}Math.pow(10,8);const S=Symbol.for("constructDateFrom");function A(t,e){return"function"==typeof t?t(e):t&&"object"==typeof t&&S in t?t[S](e):t instanceof Date?new t.constructor(e):new Date(e)}function v(t,e){return A(e||t,t)}function b(t,e,n){const r=v(t,n?.in);return isNaN(e)?A(n?.in||t,NaN):e?(r.setDate(r.getDate()+e),r):r}function L(t,e){return+v(t)<+v(e)}function R(t,e){return+v(t)>+v(e)}function D(t,e){return+v(t)===+v(e)}const N=t=>new Date(t+"T00:00:00Z"),T=t=>t.toISOString().slice(0,10);function _(t,e,n){const r=N(t),s=r.getUTCFullYear(),o=r.getUTCMonth()+e,a=s+Math.floor(o/12),i=(o%12+12)%12,c=new Date(Date.UTC(a,i+1,0)).getUTCDate(),u=new Date(Date.UTC(a,i,(()=>{switch(n.vesting_day_of_month){case"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH":return Math.min(r.getUTCDate(),c);case"29_OR_LAST_DAY_OF_MONTH":return Math.min(29,c);case"30_OR_LAST_DAY_OF_MONTH":return Math.min(30,c);case"31_OR_LAST_DAY_OF_MONTH":return Math.min(31,c);default:return Math.min(parseInt(n.vesting_day_of_month,10),c)}})()));return T(u)}const x=(t,e)=>T(b(N(t),e)),C=(t,e)=>L(N(t),N(e)),w=(t,e)=>R(N(t),N(e)),I=(t,e)=>D(N(t),N(e));function M(t,e,n,r){return"MONTHS"===e?_(t,n,r):x(t,n)}function j(t){return!!t&&"object"==typeof t&&"PICKED"===t.type&&"RESOLVED"===t.meta.type}function U(t,e,n=!0){switch(t.base.type){case"DATE":const r=V(t.base.value,t.offsets,e);return n&&w(r,e.asOf)?{type:"UNRESOLVED",blockers:[{type:"DATE_NOT_YET_OCCURRED",date:r}]}:{type:"RESOLVED",date:V(t.base.value,t.offsets,e)};case"EVENT":const s=e.events[t.base.value];return s?{type:"RESOLVED",date:V(s,t.offsets,e)}:{type:"UNRESOLVED",blockers:[{type:"EVENT_NOT_YET_OCCURRED",event:t.base.value}]}}}function V(t,e,n){let r=t;for(const s of e)r="MONTHS"===s.unit?_(r,"PLUS"===s.sign?s.value:-s.value,n):x(r,"PLUS"===s.sign?s.value:-s.value);return r}const F=t=>({type:"IMPOSSIBLE_CONDITION",condition:{base:t.base,offsets:t.offsets,constraints:t.constraints}}),k=t=>{throw new Error(`Unhandled case: ${String(t)}`)},$=(t,e,n,r)=>{const s=C(n,r),o=I(n,r),a=w(n,r);return"BEFORE"===t?e?!s:!(s||o):"AFTER"===t?e?!a:!(a||o):k(t)},P=(t,e)=>[...t.map(t=>t.blockers).flat(),{type:"UNRESOLVED_CONDITION",condition:e}];function Y(t,e,n,r){switch(n.type){case"ATOM":const s=U(n.constraint.base,r);return function(t,e,n){const{constraint:r}=n.constraints,s=r.strict;if("IMPOSSIBLE"===e.type)return"BEFORE"==r.type?"UNRESOLVED"===t.type?P([t,e],n):void 0:[F(n)];if("UNRESOLVED"===t.type&&"UNRESOLVED"===e.type)return P([t,e],n);if("RESOLVED"===t.type&&"UNRESOLVED"===e.type){if("BEFORE"===r.type)return;return[F(n)]}if("UNRESOLVED"===t.type&&"RESOLVED"===e.type)return"BEFORE"===r.type?[F(n)]:P([t],n);if("RESOLVED"===t.type&&"RESOLVED"===e.type){const o=t.date,a=e.date;return $(r.type,s,o,a)?[F(n)]:void 0}return k(t)}(e,s,t);case"AND":return n.items.reduce((n,s)=>{const o=Y({...t,constraints:s},e,s,r);return o?(n.push(...o),n):n},[]);case"OR":let o=!1;const a=[];for(const i of n.items){const n=Y({...t,constraints:i},e,i,r);n&&0!==n.length?a.push(...n):o=!0}if(o)return;return a}}function B(t){const e=[];for(const n of t)"PICKED"!==n.type&&e.push(...n.blockers);return e}function G(t){const e=[];for(const n of t)"IMPOSSIBLE"===n.type&&e.push(...n.blockers);return e}function z(t,e){let n=t[0].meta,r=t[0].picked;return t.forEach(t=>{const s=function(t,e,n){return("EARLIER_OF"===n?C(e.date,t.date):C(t.date,e.date))?e:t}(n,t.meta,e);s===t.meta&&(r=t.picked),n=s}),{picked:r,meta:n}}const H={selector:"EARLIER_OF",selectorIsSatisfied:t=>t.some(j),partialEmit:!1},K={selector:"LATER_OF",selectorIsSatisfied:t=>t.every(j),partialEmit:!0};function Q(t,e){if(t.every(t=>"IMPOSSIBLE"===t.type))return{type:"IMPOSSIBLE",blockers:[{type:"IMPOSSIBLE_SELECTOR",selector:e.selector,blockers:G(t)}]};const n=t.filter(j),r=n.length>0,s=r&&n.length===t.length,o=t.length-n.length;if(e.selectorIsSatisfied(t)){const{picked:t,meta:r}=z(n,e.selector);return{type:"PICKED",picked:t,meta:r}}if(e.partialEmit&&!s&&r){const{picked:r}=z(n,e.selector);return{type:"PICKED",picked:r,meta:{type:"UNRESOLVED",blockers:o>1?[{type:"UNRESOLVED_SELECTOR",selector:e.selector,blockers:B(t)}]:[...B(t)]}}}return{type:"UNRESOLVED",blockers:[{type:"UNRESOLVED_SELECTOR",selector:e.selector,blockers:B(t)}]}}function W(t,e){let n;switch(t.type){case"SINGLETON":const r=J(t.vesting_start,e);return"PICKED"===r.type?{type:r.type,picked:t,meta:r.meta}:r;case"EARLIER_OF":return n=t.items.map(t=>W(t,e)),Q(n,H);case"LATER_OF":return n=t.items.map(t=>W(t,e)),Q(n,K)}}function J(t,e){let n;switch(t.type){case"SINGLETON":const r=function(t,e){const n=U(t,e);if(!t.constraints)return n;const r=Y(t,n,t.constraints,e);return r&&0!==r.length?(s=r)&&"object"==typeof s&&s.every(t=>"IMPOSSIBLE"===t.type.split("_")[0])?{type:"IMPOSSIBLE",blockers:r}:{type:"UNRESOLVED",blockers:r}:n;var s}(t,e);return"RESOLVED"===r.type?{type:"PICKED",picked:t,meta:r}:r;case"EARLIER_OF":return n=t.items.map(t=>J(t,e)),Q(n,H);case"LATER_OF":return n=t.items.map(t=>J(t,e)),Q(n,K)}}function Z(t){switch(t.type){case"EVENT_NOT_YET_OCCURRED":return`EVENT ${t.event}`;case"DATE_NOT_YET_OCCURRED":return`DATE ${t.date}`;case"UNRESOLVED_CONDITION":case"IMPOSSIBLE_CONDITION":return e=t.condition,`${q({...e,type:"SINGLETON"})}`;case"UNRESOLVED_SELECTOR":case"IMPOSSIBLE_SELECTOR":switch(t.selector){case"EARLIER_OF":return`EARLIER OF ( ${t.blockers.map(Z).join(", ")} )`;case"LATER_OF":return`LATER OF ( ${t.blockers.map(Z).join(", ")} )`}}var e}function q(t){return`${n=t.base,`${n.type} ${n.value}`}${e=t.offsets,0===e.length?"":` ${e.map(tt).join(" ")}`}${t.constraints?` ${X(t.constraints)}`:""}`;var e,n}function X(t){switch(t.type){case"ATOM":return function(t){const e=t.strict?"STRICTLY ":"";return`${e}${t.type} ${q(t.base)}`}(t.constraint);case"AND":case"OR":const e=t.items.map(X);return`${t.type} ( ${e} )`}}function tt(t){return`${"MINUS"===t.sign?"-":"+"}${t.value} ${t.unit.toLowerCase()}`}function et(t,e){return{amount:e,date:t,meta:{state:"RESOLVED"}}}function nt(t,e){const n=Array.from({length:t.length},(n,r)=>function(t,e){return{amount:t,meta:{state:"IMPOSSIBLE",unresolved:e.map(Z).join(", ")}}}(t[r],e));return{installments:n,blockers:e}}function rt(t,e,n,r){const s=Array.from({length:t.length},(s,o)=>function(t,e,n,r,s){return{amount:e,meta:{state:"UNRESOLVED",symbolicDate:{type:"START_PLUS",unit:n,steps:t*r},unresolved:s.map(Z).join(", ")}}}(o,t[o],e,n,r));return{installments:s,blockers:r}}function st(t,e){const n=Array.from({length:t.length},(n,r)=>function(t,e){return{amount:t,meta:{state:"UNRESOLVED",symbolicDate:{type:"UNRESOLVED_VESTING_START"},unresolved:e.map(Z).join(", ")}}}(t[r],e));return{installments:n,blockers:e}}function ot(t,e,n){return{amount:e,meta:{state:"UNRESOLVED",symbolicDate:{type:"UNRESOLVED_CLIFF",date:t},unresolved:n.map(Z).join(", ")}}}function at(t,e,n,r){const s={...r,events:{...r.events,vestingStart:t.meta.date}},o=t.picked.periodicity,a=J(o.cliff,s);if("IMPOSSIBLE"===a.type)return nt(n,a.blockers);if("UNRESOLVED"===a.type)return function(t,e,n){return{installments:Array.from({length:e.length},(r,s)=>ot(t[s],e[s],n)),blockers:n}}(e,n,a.blockers);if(j(a))return function(t,e,n){const r=it(t,e,n,({date:t,amount:e})=>et(t,e));return{installments:r,blockers:[]}}(e,n,a.meta.date);const i=a.meta.blockers;if("LATER_OF"===o.cliff.type){const t=function(t,e){const n=[];for(const s of t.items){const t=J(s,e);"PICKED"===t.type&&"RESOLVED"===t.meta.type&&n.push(t.meta.date)}if(0===n.length)return;let r=n[0];for(let s=1;s<n.length;s++)C(r,n[s])&&(r=n[s]);return r}(o.cliff,s);if(t)return function(t,e,n,r){const s=it(t,e,n,({date:t,amount:e})=>ot(t,e,r));return{installments:s,blockers:r}}(e,n,t,i)}return rt(n,o.type,o.length,i)}function it(t,e,n,r){const s=[];let o=0,a=!1;for(let i=0;i<t.length;i++){const c=t[i],u=e[i],l=C(c,n),f=I(c,n);l?o+=u:f?(o+=u,s.push(r({date:c,amount:o})),a=!0):(!a&&C(n,c)&&o>0&&(s.push(r({date:n,amount:o})),a=!0),s.push(r({date:c,amount:u})))}return s}function ct(t,e){const{ctx:n,statementQuantity:r}=function(t,e){const n=(r=e,{...r,vesting_day_of_month:r.vesting_day_of_month??"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH",allocation_type:r.allocation_type??"CUMULATIVE_ROUND_DOWN"});var r;const s=(o=t.amount,a=n.grantQuantity,"QUANTITY"===o.type?o.value:a*(o.numerator/o.denominator));var o,a;if(s%1!=0||s<0)throw new Error(`expandAllocatedSchedule: totalQuantity must be a positive whole number or zero: ${s}`);return{ctx:n,statementQuantity:s}}(t,e),s=W(t.expr,n);switch(s.type){case"IMPOSSIBLE":return nt([r],s.blockers);case"UNRESOLVED":return st([r],s.blockers);case"PICKED":return function(t,e,n){const r=t.picked,s=r.periodicity,{type:o,length:a,occurrences:i}=s;if(i<1)throw new Error(`Expected ${JSON.stringify(t.picked)} to have at least one installment.`);let c=function(t,e,n){if(e<=0)return[];switch(n){case"CUMULATIVE_ROUNDING":{const n=new Array(e).fill(0);for(let r=0;r<e;r++){const s=0===r?0:n.slice(0,r).reduce((t,e)=>t+e,0),o=Math.round((r+1)/e*t);n[r]=o-s}return n}case"CUMULATIVE_ROUND_DOWN":{const n=new Array(e).fill(0);for(let r=0;r<e;r++){const s=0===r?0:n.slice(0,r).reduce((t,e)=>t+e,0),o=Math.floor((r+1)/e*t);n[r]=o-s}return n}case"FRONT_LOADED":{const n=Math.floor(t/e),r=t%e;return Array.from({length:e},(t,e)=>e<r?n+1:n)}case"BACK_LOADED":{const n=Math.floor(t/e),r=t%e;return Array.from({length:e},(t,s)=>s>=e-r?n+1:n)}case"FRONT_LOADED_TO_SINGLE_TRANCHE":{const n=Math.floor(t/e);return[n+t%e,...Array.from({length:e-1},()=>n)]}case"BACK_LOADED_TO_SINGLE_TRANCHE":{const n=Math.floor(t/e),r=t%e;return[...Array.from({length:e-1},()=>n),n+r]}default:return Array.from({length:e},()=>Math.floor(t/e))}}(e,i,n.allocation_type);if("UNRESOLVED"===t.meta.type)return rt(c,o,a,t.meta.blockers);let u=t.meta.date,l=[];for(let d=0;d<i;d++)u=M(u,o,a,n),l.push(u);const{newDates:f,newAmounts:p}=function(t,e,n){const r=it(t,e,n,({date:t,amount:e})=>({date:t,amount:e}));let s=[],o=[];for(const a of r)s.push(a.date),o.push(a.amount);return{newDates:s,newAmounts:o}}(l,c,n.events.grantDate);return l=f,c=p,s.cliff?at(t,l,c,n):function(t,e){const n=[];return t.forEach((t,r)=>n.push(et(t,e[r]))),{installments:n,blockers:[]}}(l,c)}(s,r,n)}}function ut({ast:t}){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{style:{marginBottom:4},children:"AST"}),(0,s.jsx)("pre",{style:{background:"var(--ifm-pre-background)",padding:12,overflow:"auto"},children:JSON.stringify(t,null,2)})]})}function lt({installments:t}){return(0,s.jsx)("div",{children:(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Amount"}),(0,s.jsx)("th",{children:"Date"})]})}),(0,s.jsx)("tbody",{children:t.map((t,e)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:t.amount}),(0,s.jsx)("td",{children:"RESOLVED"===t.meta.state?t.date:JSON.stringify(t.meta.symbolicDate)})]},e))})]})})}function ft({schedules:t}){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{style:{marginBottom:4},children:"Installments"}),t.map((t,e)=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(lt,{installments:t.installments},e),t.blockers.length>0?JSON.stringify(t.blockers):null]}))]})}function pt({events:t,eventName:e,setEventName:n,eventDate:r,setEventDate:o,setEvents:a}){return(0,s.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,s.jsx)("div",{style:{fontWeight:600},children:"Events (name - YYYY-MM-DD)"}),(0,s.jsxs)("div",{style:{display:"grid",gap:8,gridTemplateColumns:"1fr 180px 120px"},children:[(0,s.jsx)("input",{type:"text",placeholder:"e.g., milestone",value:e,onChange:t=>n(t.target.value),style:{padding:8}}),(0,s.jsx)("input",{type:"date",value:r,onChange:t=>o(t.target.value),style:{padding:8}}),(0,s.jsx)("button",{onClick:()=>{const t=e.trim(),s=r;t&&(a(e=>({...e,[t]:s})),n(""))},disabled:!e.trim(),style:{padding:8},children:"Add event"})]}),Object.keys(t).length>0?(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid var(--ifm-toc-border-color)"},children:"Name"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid var(--ifm-toc-border-color)"},children:"Date (YYYY-MM-DD)"}),(0,s.jsx)("th",{style:{width:80,borderBottom:"1px solid var(--ifm-toc-border-color)"}})]})}),(0,s.jsx)("tbody",{children:Object.entries(t).map(([t,e],n)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:{padding:8,borderBottom:"1px solid var(--ifm-toc-border-color)"},children:t}),(0,s.jsx)("td",{style:{padding:8,borderBottom:"1px solid var(--ifm-toc-border-color)"},children:e}),(0,s.jsx)("td",{style:{padding:8,textAlign:"right",borderBottom:"1px solid var(--ifm-toc-border-color)"},children:(0,s.jsx)("button",{onClick:()=>(t=>{a(e=>{const{[t]:n,...r}=e;return r})})(t),children:"Remove"})})]},`${t}-${n}`))})]}):(0,s.jsx)("div",{style:{opacity:.7},children:"No custom events added yet."})]})}function dt(t){return new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().slice(0,10)}function ht(){const[t,e]=(0,a.useState)(100),[n,r]=(0,a.useState)(new Date),[o,c]=(0,a.useState)({}),[l,f]=(0,a.useState)(""),[p,d]=(0,a.useState)(null),[E,m]=(0,a.useState)(null),[y,g]=(0,a.useState)(null),[O,S]=(0,a.useState)(""),[A,v]=(0,a.useState)(dt(new Date)),b=(0,a.useMemo)(()=>dt(new Date),[]),L=(0,a.useCallback)(()=>{try{const e=u(l),r=e.map(h);d(r);const s={events:{grantDate:dt(n),...o},grantQuantity:t,asOf:b,vesting_day_of_month:"VESTING_START_DAY_OR_LAST_DAY_OF_MONTH",allocation_type:"CUMULATIVE_ROUND_DOWN"},a=r.map(t=>ct(t,s));m(a),g(null)}catch(e){d(null),m(null),g(e?.message??String(e))}},[l,t,n,o,b]);return(0,a.useEffect)(()=>{const t=window.setTimeout(L,250);return()=>window.clearTimeout(t)},[L,l,t,n,o]),(0,s.jsx)(i.A,{children:()=>(0,s.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,s.jsx)("label",{style:{fontWeight:600},children:"Try a vestlang statement"}),(0,s.jsxs)("div",{style:{display:"flex",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[(0,s.jsxs)("label",{style:{display:"flex",gap:6},children:[(0,s.jsx)("span",{children:"Quantity"}),(0,s.jsx)("input",{type:"number",min:0,value:Number.isFinite(t)?t:100,onChange:t=>e(Number(t.target.value)||100),style:{padding:8}})]}),(0,s.jsxs)("label",{style:{display:"flex",gap:6},children:[(0,s.jsx)("span",{children:"Grant Date"}),(0,s.jsx)("input",{type:"date",value:dt(n),onChange:t=>r(new Date(t.target.value)),style:{padding:8}})]})]}),(0,s.jsx)(pt,{events:o,eventName:O,setEventName:S,eventDate:A,setEventDate:v,setEvents:c}),(0,s.jsx)("textarea",{value:l,onChange:t=>f(t.target.value),rows:3}),y&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Error:"}),y]}),p&&(0,s.jsx)(ut,{ast:p}),E&&(0,s.jsx)(ft,{schedules:E})]})})}const Et={title:"Playground",sidebar_position:5},mt=void 0,yt={},gt=[];function Ot(t){return(0,s.jsx)(ht,{})}function St(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(Ot,{...t})}):Ot()}}}]);