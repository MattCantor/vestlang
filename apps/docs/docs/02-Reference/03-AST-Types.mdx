---
title: AST Types
sidebar_position: 3
---

# Abstract Syntax Tree (AST)

Each parsed statement produces a structured, type-safe AST defined in `packages/dsl/src/types.ts`.

---

## Root Statement

```ts
interface ASTStatement {
  amount: AstAmount;
  expr: ASTExpr;
}
```

---

## Amounts

| Type | Description |
|------|--------------|
| `AmountAbsolute` | Absolute number of shares |
| `AmountPercent` | Fractional percentage of total (0â€“1) |

---

## Expressions

| Type | Description |
|------|--------------|
| `ASTSchedule` | Core schedule expression |
| `EarlierOfASTSchedules` | Composite that vests on the earliest of sub-schedules |
| `LaterOfASTSchedules` | Composite that vests on the latest of sub-schedules |

Each combinator requires at least two items (`TwoOrMore<T>`).

---

## Durations

```ts
interface Duration {
  type: "Duration";
  value: number;
  unit: "DAYS" | "MONTHS";
}
```

Weeks and years are normalized to days and months respectively.

---

## Anchors and Predicates

| Category | Example | Type |
|-----------|----------|------|
| Date | `DATE 2025-12-31` | `DateAnchor` |
| Event | `EVENT IPO` | `EventAnchor` |
| Qualified | `EVENT IPO AFTER DATE 2024-12-31` | `QualifiedAnchor` |

Predicates include:
- `After`
- `Before`
- `Between`

---

## Recursive Terms

### FromTerm

```ts
type FromTerm =
  | Anchor
  | QualifiedAnchor
  | EarlierOfFrom
  | LaterOfFrom;
```

### CliffTerm

```ts
type CliffTerm =
  | Duration
  | Anchor
  | QualifiedAnchor
  | EarlierOfCliff
  | LaterOfCliff;
```

---

## Schedules

```ts
interface ASTSchedule {
  type: "Schedule";
  from?: FromTerm;
  over: Duration;
  every: Duration;
  cliff?: CliffTerm;
}
```

---

## Utilities

Type guards (from `raw-ast-guards.ts`) ensure safe narrowing:

```ts
isSchedule(expr)
isQualifiedAnchor(term)
isBetweenPred(pred)
isTwoOrMore(arr)
```

See also: [Normalizer Types](normalizer-types.md)
